<!doctype html>
<html lang="ja" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>仮登録｜協力ドライバー登録フォーム｜drivers-site（山口県）</title>
  <meta name="description" content="山口県エリアの協力ドライバー仮登録フォーム。ニックネーム・拠点市町村・車種・連絡先・入院保険の確認などを入力して登録できます。" />
  <link rel="canonical" href="https://takeshimonoseki.github.io/register.html" />
  <meta property="og:title" content="仮登録｜協力ドライバー登録フォーム｜drivers-site（山口県）" />
  <meta property="og:url" content="https://takeshimonoseki.github.io/register.html" />
  <meta property="og:type" content="website" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

  <!-- Tailwind CSS (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { deep: '#050505', muted: '#94A3B8' },
          fontFamily: { sans: ['Inter', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] }
        }
      }
    }
  </script>

  <link rel="stylesheet" href="./drivers.css" />
  <link rel="stylesheet" href="./assets/sakura.css" />
  <script src="./config.js"></script>
  <script src="./drivers.js" defer></script>

  <!-- Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    .field-input {
      width: 100%;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 10px 14px;
      color: white;
      font-size: 14px;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .field-input:focus {
      outline: none;
      border-color: rgba(56,189,248,0.5);
      box-shadow: 0 0 0 3px rgba(56,189,248,0.1);
    }
    .field-input::placeholder { color: rgba(255,255,255,0.25); }
    select.field-input { appearance: none; cursor: pointer; }
    select.field-input option { background: #1e293b; color: white; }
    textarea.field-input { resize: vertical; min-height: 80px; }

    .is-invalid { border-color: rgba(239,68,68,0.6) !important; }
    .is-invalid:focus { box-shadow: 0 0 0 3px rgba(239,68,68,0.15) !important; }
    .field-error-text { color: #f87171; font-size: 12px; margin-top: 4px; }

    .choice-radio { display: flex; flex-wrap: wrap; gap: 8px; }
    .choice-radio label {
      display: flex; align-items: center; gap: 6px;
      padding: 8px 14px; border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.1);
      background: rgba(255,255,255,0.03);
      cursor: pointer; font-size: 13px; font-weight: 600;
      transition: all 0.2s ease;
    }
    .choice-radio label:hover { background: rgba(255,255,255,0.06); border-color: rgba(255,255,255,0.2); }
    .choice-radio label:has(:checked) { border-color: rgba(56,189,248,0.5); background: rgba(56,189,248,0.05); }
    .choice-radio input[type="radio"],
    .choice-radio input[type="checkbox"] { accent-color: #38bdf8; }

    .error-banner {
      padding: 16px; border-radius: 16px;
      background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3);
      color: #fca5a5; font-size: 14px;
    }
    .error-banner strong { color: #f87171; }
    .error-banner ul { margin-top: 8px; padding-left: 18px; }
    .error-banner li { margin-bottom: 4px; }

    .success-banner {
      padding: 20px; border-radius: 16px;
      background: rgba(34,197,94,0.1); border: 1px solid rgba(34,197,94,0.3);
      color: #86efac; font-size: 14px;
    }
    .success-banner strong { color: #4ade80; }
    .summary-list { list-style: none; padding: 0; margin-top: 8px; }
    .summary-list li {
      padding: 6px 0; border-bottom: 1px solid rgba(255,255,255,0.05);
      font-size: 13px; color: rgba(255,255,255,0.7);
    }

    .terms-box {
      padding: 16px; border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.1);
      background: rgba(255,255,255,0.02);
    }
    .terms-box .terms-title { font-weight: 800; font-size: 14px; margin-bottom: 8px; }
    .terms-box .terms-list { padding-left: 18px; font-size: 13px; color: rgba(255,255,255,0.6); }
    .terms-box .terms-list li { margin-bottom: 6px; }
    .terms-box .terms-note { font-size: 12px; color: rgba(255,255,255,0.4); margin-top: 8px; }
    .terms-box .terms-note a { color: #38bdf8; text-decoration: underline; }

    #agreeLabel { font-size: 13px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; }
    #agreeLabel.is-invalid { color: #f87171; }
    #agreeLabel input { accent-color: #38bdf8; }

    .submit-hint { font-size: 12px; color: rgba(255,255,255,0.4); margin-bottom: 8px; }
    .is-disabled { opacity: 0.4; pointer-events: none; }
  </style>
</head>
<body class="bg-deep text-white min-h-screen">

  <!-- HEADER（全ページ統一・sticky） -->
  <header class="sticky top-0 w-full z-[1000] bg-deep/80 backdrop-blur-xl border-b border-white/5" id="top">
    <div class="header-inner max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
      <a href="./index.html" class="flex items-center gap-3 group">
        <div class="hidden sm:flex flex-col items-center justify-center px-3 py-1 bg-white/5 border border-white/10 rounded-full" aria-label="対応地域">
          <div class="text-[9px] tracking-widest font-extrabold text-white/80" id="regionEn">YAMAGUCHI</div>
          <div class="text-[9px] font-bold text-white/50" id="regionJa">山口県</div>
        </div>
        <div class="w-9 h-9 rounded-xl bg-gradient-to-br from-red-900 to-red-500 flex items-center justify-center shadow-lg shadow-red-900/30" aria-hidden="true">
          <span class="w-4 h-4 rounded-full border-2 border-white/90"></span>
        </div>
        <div>
          <div class="text-sm font-black tracking-wide leading-none" id="companyName">軽貨物TAKE</div>
          <div class="text-[10px] text-muted font-bold font-mono mt-0.5">DRIVERS POOL</div>
        </div>
      </a>

      <div class="flex items-center gap-4 flex-wrap">
        <div class="hidden lg:flex items-center gap-3 text-xs text-muted" aria-label="連絡先">
          <a href="https://line.me/R/ti/p/%40277rcesk" id="headerLineLink" data-line-ui="1" class="hover:text-white transition-colors" target="_blank" rel="noopener noreferrer">LINE</a>
          <span class="text-white/20">|</span>
          <a href="#" id="headerMailLink" class="hover:text-white transition-colors">takeshimonoseki@gmail.com</a>
        </div>

        <nav class="hidden md:flex gap-1 flex-wrap" aria-label="メイン">
          <a href="./index.html" class="px-4 py-2 rounded-full text-xs font-bold text-muted hover:text-white hover:bg-white/5 transition-colors">トップ</a>
          <a href="./consult.html" class="px-4 py-2 rounded-full text-xs font-bold text-muted hover:text-white hover:bg-white/5 transition-colors">相談スタート</a>
          <a href="./startup.html" class="px-4 py-2 rounded-full text-xs font-bold text-muted hover:text-white hover:bg-white/5 transition-colors">開業トータル相談</a>
          <a href="./vehicle.html" class="px-4 py-2 rounded-full text-xs font-bold text-muted hover:text-white hover:bg-white/5 transition-colors">車両の相談</a>
          <a href="./register.html" class="px-4 py-2 rounded-full text-xs font-bold bg-white text-black shadow-lg shadow-white/10" aria-current="page">仮登録</a>
        </nav>

        <button type="button" class="md:hidden p-2 text-white bg-white/10 rounded-full hover:bg-white/20 transition-colors" aria-label="メニューを開く" aria-expanded="false" aria-controls="nav-overlay" id="menu-toggle">
          <i data-lucide="menu" class="w-5 h-5"></i>
        </button>
      </div>
    </div>
  </header>

  <div id="nav-overlay" aria-hidden="true" role="dialog" aria-label="メニュー">
    <button type="button" class="nav-overlay-close" aria-label="メニューを閉じる" id="menu-close">
      <i data-lucide="x" class="w-6 h-6"></i>
    </button>
    <a href="./index.html">トップ</a>
    <a href="./consult.html">相談スタート</a>
    <a href="./startup.html">開業トータル相談</a>
    <a href="./vehicle.html">車両の相談</a>
    <a href="./register.html">仮登録</a>
  </div>

  <!-- MAIN -->
  <main class="pt-24 pb-16 px-4 sm:px-6 lg:px-8 max-w-3xl mx-auto">

    <!-- Intro -->
    <div class="glass-card p-6 md:p-10 mb-6 reveal-hidden relative overflow-hidden">
      <div class="absolute -top-20 -right-20 w-[300px] h-[300px] bg-gradient-to-br from-blue-600/10 to-transparent rounded-full blur-3xl pointer-events-none"></div>
      <div class="relative z-10">
        <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/5 border border-white/10 text-[11px] font-bold text-muted mb-4">
          <i data-lucide="info" class="w-3 h-3"></i> 求人ではなく「登録プール」です
        </span>
        <h1 class="text-2xl sm:text-3xl font-black tracking-tight mb-3">協力ドライバー登録フォーム（仮登録）</h1>
        <p class="text-sm text-muted leading-relaxed mb-2">
          お客さまとドライバーさんを<strong class="text-white">直接つながず</strong>、代表たけが間に入る前提の登録フォームです。
        </p>
        <p class="text-xs text-white/40">
          ※登録後に「本登録（本人確認）」をご案内する場合があります。<br>
          ※登録内容は後から変更・削除の依頼が可能です（LINEからご連絡ください）。
        </p>
      </div>
    </div>

    <!-- Registration Form -->
    <div class="glass-card p-6 md:p-10 reveal-hidden delay-100">
      <form id="registerForm" novalidate>

        <!-- Error Banner -->
        <div id="errorBox" class="error-banner mb-6" style="display:none;">
          <strong>送信できませんでした。</strong>
          <div class="mt-2">赤枠の項目をご確認ください。</div>
          <ul id="errorList"></ul>
        </div>

        <!-- Required Fields Box -->
        <div class="p-5 rounded-2xl border border-amber-500/20 bg-amber-500/5 mb-6">
          <div class="flex items-center gap-2 mb-5">
            <i data-lucide="zap" class="w-4 h-4 text-amber-400"></i>
            <span class="font-bold text-sm">まずここだけ入力</span>
            <span class="px-2 py-0.5 rounded-full bg-amber-500/10 text-amber-400 text-[10px] font-bold">必須まとめ</span>
          </div>

          <div class="space-y-5">
            <!-- Nickname -->
            <div>
              <div class="flex items-center gap-2 mb-2">
                <label class="text-sm font-bold" for="nickname">ニックネーム（公開名）</label>
                <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-emerald-500/10 text-emerald-400">公開</span>
                <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-red-500/10 text-red-400">必須</span>
              </div>
              <input type="text" id="nickname" name="nickname" autocomplete="off" placeholder="例：やまぐち便 さん" class="field-input" />
              <div class="text-xs text-muted mt-1">本名じゃなくてOKです。</div>
            </div>

            <!-- City -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <div class="flex items-center gap-2 mb-2">
                  <label class="text-sm font-bold" for="city">拠点の市町村</label>
                  <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-emerald-500/10 text-emerald-400">公開</span>
                  <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-red-500/10 text-red-400">必須</span>
                </div>
                <select id="city" name="city" class="field-input">
                  <option value="">選択してください</option>
                  <option value="下関市">下関市</option>
                  <option value="北九州市">北九州市</option>
                  <option value="山口市">山口市</option>
                  <option value="宇部市">宇部市</option>
                  <option value="防府市">防府市</option>
                  <option value="周南市">周南市</option>
                  <option value="岩国市">岩国市</option>
                  <option value="光市">光市</option>
                  <option value="山陽小野田市">山陽小野田市</option>
                  <option value="萩市">萩市</option>
                  <option value="長門市">長門市</option>
                  <option value="美祢市">美祢市</option>
                  <option value="柳井市">柳井市</option>
                  <option value="田布施町">田布施町</option>
                  <option value="平生町">平生町</option>
                  <option value="その他">その他（自由入力）</option>
                </select>
              </div>

              <div id="cityOtherRow" style="display:none;">
                <div class="flex items-center gap-2 mb-2">
                  <label class="text-sm font-bold" for="cityOther">その他の市町村名</label>
                  <span class="text-xs text-muted">公開</span>
                </div>
                <input type="text" id="cityOther" placeholder="例：山口県 ○○郡 △△町" class="field-input" />
              </div>
            </div>

            <!-- 車種（メーカー＋車種自由入力） -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <div class="flex items-center gap-2 mb-2">
                  <label class="text-sm font-bold" for="vehicleMaker">メーカー</label>
                  <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-emerald-500/10 text-emerald-400">公開</span>
                  <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-red-500/10 text-red-400">必須</span>
                </div>
                <select id="vehicleMaker" name="vehicleMaker" class="field-input">
                  <option value="">選択してください</option>
                  <option value="トヨタ">トヨタ</option>
                  <option value="ホンダ">ホンダ</option>
                  <option value="日産">日産</option>
                  <option value="スズキ">スズキ</option>
                  <option value="ダイハツ">ダイハツ</option>
                  <option value="マツダ">マツダ</option>
                  <option value="三菱">三菱</option>
                  <option value="スバル">スバル</option>
                  <option value="いすゞ">いすゞ</option>
                  <option value="その他">その他</option>
                </select>
              </div>
              <div>
                <div class="flex items-center gap-2 mb-2">
                  <label class="text-sm font-bold" for="vehicleModel">車種</label>
                  <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-emerald-500/10 text-emerald-400">公開</span>
                  <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-red-500/10 text-red-400">必須</span>
                </div>
                <input type="text" id="vehicleModel" name="vehicleModel" list="vehicleModelList" autocomplete="off" placeholder="例：ハイゼットカーゴ／N-VAN／NV200" class="field-input" />
                <datalist id="vehicleModelList"></datalist>
                <div class="text-xs text-muted mt-1">軽バン・軽乗用もOKです。</div>
              </div>
            </div>

            <!-- 仕事用車両・ナンバー状況 -->
            <div>
              <div class="flex items-center gap-2 mb-2">
                <label class="text-sm font-bold">仕事用の車（黒ナンバー）状況</label>
                <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-purple-500/10 text-purple-400">内部のみ</span>
                <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-red-500/10 text-red-400">必須</span>
              </div>
              <div class="choice-radio" id="workVehicleStatusRow">
                <label><input type="radio" name="workVehicleStatus" value="黒ナンバー取得済み" />黒ナンバー取得済み</label>
                <label><input type="radio" name="workVehicleStatus" value="申請中・取得予定" />申請中・取得予定</label>
                <label><input type="radio" name="workVehicleStatus" value="未定（これから）" />未定（これから）</label>
              </div>
              <div class="text-xs text-muted mt-1">「軽貨物として稼働できる状態かどうか」を把握するだけです。</div>
            </div>

            <!-- 入院保険（証拠不要・チェックのみ） -->
            <div>
              <label class="flex items-center gap-2 text-sm font-bold cursor-pointer" id="hospitalInsuranceLabel">
                <input type="checkbox" id="hospitalInsurance" name="hospitalInsurance" class="accent-sky-400" />
                入院保険に加入しています（証拠不要）
              </label>
            </div>

            <!-- Contact Info（どれか1つでOK → メール or LINE表示名） -->
            <div>
              <div class="flex items-center gap-2 mb-2">
                <label class="text-sm font-bold">連絡先（メール or LINE表示名）</label>
                <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-purple-500/10 text-purple-400">非公開</span>
                <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-red-500/10 text-red-400">必須</span>
              </div>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <input type="email" id="contactEmail" name="contactEmail" autocomplete="email" placeholder="メール（例：mail@example.com）" class="field-input" />
                <input type="text" id="contactLineName" name="contactLineName" autocomplete="off" placeholder="LINE表示名（例：たけ さん）" class="field-input" />
              </div>
              <div class="text-xs text-muted mt-1">サイトには公開しません（代表たけだけが控えます）。</div>
            </div>

            <!-- Message to Take -->
            <div>
              <div class="flex items-center gap-2 mb-2">
                <label class="text-sm font-bold" for="messageToTake">代表たけへ伝えたいこと（任意）</label>
                <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-purple-500/10 text-purple-400">内部のみ</span>
              </div>
              <textarea id="messageToTake" name="messageToTake" placeholder="例：夜が強い／スポット好き／安全運転重視 など（短くOK）" class="field-input"></textarea>
            </div>

            <!-- Terms -->
            <div>
              <div class="terms-box" id="termsBox">
                <div class="terms-title">同意内容（必ず確認）</div>
                <ul class="terms-list">
                  <li>これは求人ではなく「登録プール」です（すぐに仕事が発生する保証はありません）。</li>
                  <li>入力内容は <b>代表たけ</b> が連絡・配車判断のために利用します（お客さまへ直接共有しません）。</li>
                  <li>登録後でも、内容の変更・削除依頼が可能です（LINEから連絡）。</li>
                  <li>迷惑行為・虚偽入力・無断キャンセルなどがある場合、以後の連絡をお断りすることがあります。</li>
                  <li>通信状況により通知が届かない可能性があります。未着時は下の「LINEで内容を送る」を使ってください。</li>
                </ul>
                <div class="terms-note">
                  個人情報の取り扱いは <a href="./privacy.html">プライバシー・個人情報の取扱い</a> をご確認ください。
                </div>
              </div>

              <label class="flex items-center gap-2 mt-3 text-sm font-semibold cursor-pointer" id="agreeLabel">
                <input type="checkbox" id="agreeTerms" class="accent-sky-400" />
                上記の同意内容に同意して仮登録します（必須）
              </label>
              <p class="text-xs text-muted mt-1">※登録すると、入力内容が代表たけのLINEに届きます。</p>
            </div>

            <!-- Submit -->
            <div class="flex flex-col items-end gap-2">
              <div class="submit-hint" id="submitHint" aria-live="polite"></div>
              <button type="submit" class="inline-flex items-center gap-2 px-6 py-3 rounded-2xl bg-white text-black font-bold text-sm shadow-lg shadow-white/10 hover:-translate-y-0.5 transition-all active:scale-95" id="submitBtn">
                <i data-lucide="send" class="w-4 h-4"></i> 仮登録する
              </button>
            </div>
          </div>
        </div>

        <!-- Optional Fields -->
        <details class="group mt-6">
          <summary class="cursor-pointer text-sm font-bold text-white/60 hover:text-white transition-colors flex items-center gap-2 select-none p-4 rounded-2xl border border-white/10 bg-white/[0.02]">
            <i data-lucide="chevron-down" class="w-4 h-4 transition-transform group-open:rotate-180"></i>
            任意：追加で書けます（開く）
          </summary>

          <div class="space-y-5 mt-4 p-5 rounded-2xl border border-white/5 bg-white/[0.01]">
            <!-- Profile -->
            <div>
              <div class="flex items-center gap-2 mb-2">
                <label class="text-sm font-bold" for="profile">ひとことプロフィール（任意）</label>
                <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-emerald-500/10 text-emerald-400">公開</span>
              </div>
              <textarea id="profile" name="profile" placeholder="例：宅配経験あり／スポット好き／安全運転重視、など短くOK" class="field-input"></textarea>
              <div class="text-xs text-muted mt-1 font-mono" id="profileCounter">0 文字</div>
            </div>

            <!-- Dispatch Hope -->
            <div>
              <div class="flex items-center gap-2 mb-2">
                <label class="text-sm font-bold" for="dispatchHope">配車希望（任意）</label>
                <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-purple-500/10 text-purple-400">内部のみ</span>
              </div>
              <textarea id="dispatchHope" name="dispatchHope" placeholder="※記入しなくてOK。書くなら：平日午前が多いと助かります など" class="field-input"></textarea>
            </div>

            <!-- NG Conditions -->
            <div>
              <div class="flex items-center gap-2 mb-2">
                <label class="text-sm font-bold" for="ngText">NG条件（任意）</label>
                <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-purple-500/10 text-purple-400">内部のみ</span>
              </div>
              <textarea id="ngText" name="ngText" placeholder="例：深夜NG／長距離は○kmまで、など" class="field-input"></textarea>
            </div>
          </div>
        </details>
      </form>

      <!-- Network Error -->
      <div id="networkErrorBox" class="error-banner mt-6" style="display:none;">
        <strong>送信エラーが発生しました。</strong>
        <div class="mt-2">
          通信状況や設定の影響で届いていない可能性があります。<br>
          取りこぼし防止のため、下のボタンから<strong>内容をLINEメッセージとして送ってください</strong>（画像は送れません）。
        </div>
        <div class="mt-3">
          <button type="button" class="inline-flex items-center gap-2 px-4 py-2.5 rounded-xl bg-[#06C755] text-white font-bold text-sm shadow-lg shadow-green-500/20 hover:-translate-y-0.5 transition-all" id="btnLineFallback" data-line-ui="1">
            <i data-lucide="message-circle" class="w-4 h-4"></i> LINEで内容を送る
          </button>
        </div>
      </div>

      <!-- Success -->
      <div id="successBox" class="success-banner mt-6" style="display:none;">
        <strong>仮登録を受け付けました。</strong>
        <div class="mt-2">
          受付番号：<span id="receiptId" class="font-mono text-white"></span><br>
          ステータス：<span class="font-mono text-white">受領</span>
        </div>
        <p class="text-xs text-muted mt-2">※代表たけのLINEに通知しました（届かない場合は、上の「LINEで内容を送る」を使ってください）。</p>

        <div class="mt-4 p-4 rounded-xl border border-white/5 bg-white/[0.02]">
          <div class="text-xs font-bold text-muted uppercase tracking-wider mb-2">送信内容（確認用）</div>
          <ul id="publicSummary" class="summary-list"></ul>
        </div>

        <div class="mt-3">
          <button type="button" class="inline-flex items-center gap-2 px-4 py-2.5 rounded-xl border border-white/10 bg-white/5 text-white/80 font-bold text-sm hover:bg-white/10 transition-all" id="btnResetForm">
            <i data-lucide="rotate-ccw" class="w-3.5 h-3.5"></i> もう一度入力する
          </button>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="border-t border-white/5 mt-12 pt-8 pb-4 text-center">
      <div class="text-xs text-muted" id="footerCompany">drivers-site｜協力ドライバー登録プール（山口県）</div>
      <div class="text-[11px] text-white/30 mt-1">フォームからの登録に加え、LINE経由での登録内容修正・削除依頼も受け付けます。</div>
      <p class="text-[11px] text-muted mt-2"><a href="./privacy.html" class="underline underline-offset-4 decoration-white/20 hover:decoration-white/50 transition-colors">プライバシー・個人情報の取扱い</a></p>
    </footer>
  </main>

  <script>
    lucide.createIcons();

    // CONFIG反映
    (function applyConfig() {
      if (!window.CONFIG) return;
      var regionJa = document.getElementById("regionJa");
      var regionEn = document.getElementById("regionEn");
      var companyName = document.getElementById("companyName");
      var footerCompany = document.getElementById("footerCompany");

      if (regionJa) regionJa.textContent = window.CONFIG.REGION_LABEL || "山口県";
      if (regionEn) regionEn.textContent = (window.CONFIG.REGION_CODE || "YAMAGUCHI").toUpperCase();
      if (companyName) companyName.textContent = window.CONFIG.COMPANY_NAME || "軽貨物TAKE";
      if (footerCompany) footerCompany.textContent = (window.CONFIG.COMPANY_NAME || "drivers-site") + "｜協力ドライバー登録プール（" + (window.CONFIG.REGION_LABEL || "山口県") + "）";

      var lineUrl = window.CONFIG.LINE_URL || "https://line.me/R/ti/p/%40277rcesk";
      var lineLink = document.getElementById("headerLineLink");
      var mailLink = document.getElementById("headerMailLink");
      var email = window.CONFIG.EMAIL_TO || "";

      if (lineLink) lineLink.href = lineUrl;
      if (mailLink && email) { mailLink.href = "mailto:" + email; mailLink.textContent = email; }
    })();

    function openLineShareWithText(text) {
      var oa = (window.CONFIG && window.CONFIG.LINE_OA_ID) ? window.CONFIG.LINE_OA_ID : "@277rcesk";
      if (oa[0] !== "@") oa = "@" + oa;
      var msg = encodeURIComponent(String(text || "").slice(0, 5000));
      var isMobile = /iphone|ipad|ipod|android/i.test(navigator.userAgent || "");
      var base = isMobile ? "line://oaMessage/" : "https://line.me/R/oaMessage/";
      window.open(base + oa + "/?" + msg, "_blank", "noopener,noreferrer");
    }

    function fileToDataUrlSmart(file, opts) {
      opts = opts || {};
      var maxW = opts.maxW || 1280;
      var maxH = opts.maxH || 1280;
      var quality = typeof opts.quality === "number" ? opts.quality : 0.82;

      return new Promise(function(resolve, reject) {
        if (!file) return resolve(null);

        var reader = new FileReader();
        reader.onerror = function(){ reject(new Error("file_read_failed")); };
        reader.onload = function() {
          var dataUrl = reader.result;

          // 画像以外（PDF等）
          if (!/^image\//.test(file.type || "")) {
            return resolve({ name: file.name || "file", type: file.type || "application/octet-stream", dataUrl: String(dataUrl || "") });
          }

          var img = new Image();
          img.onerror = function() {
            resolve({ name: file.name || "image", type: file.type || "image/*", dataUrl: String(dataUrl || "") });
          };
          img.onload = function() {
            var w = img.naturalWidth || img.width || 0;
            var h = img.naturalHeight || img.height || 0;
            if (!w || !h) {
              return resolve({ name: file.name || "image", type: file.type || "image/*", dataUrl: String(dataUrl || "") });
            }
            var scale = Math.min(1, maxW / w, maxH / h);
            if (scale >= 1) {
              return resolve({ name: file.name || "image", type: file.type || "image/*", dataUrl: String(dataUrl || "") });
            }
            var cw = Math.max(1, Math.round(w * scale));
            var ch = Math.max(1, Math.round(h * scale));
            var canvas = document.createElement("canvas");
            canvas.width = cw;
            canvas.height = ch;
            var ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, cw, ch);
            try {
              var outDataUrl = canvas.toDataURL("image/jpeg", quality);
              var base = (file.name || "image").replace(/\.[^.]+$/, "");
              resolve({ name: base + ".jpg", type: "image/jpeg", dataUrl: outDataUrl });
            } catch (e) {
              resolve({ name: file.name || "image", type: file.type || "image/*", dataUrl: String(dataUrl || "") });
            }
          };
          img.src = String(dataUrl || "");
        };
        reader.readAsDataURL(file);
      });
    }

    // Elements
    const nicknameEl = document.getElementById("nickname");
    const cityEl = document.getElementById("city");
    const cityOtherRow = document.getElementById("cityOtherRow");
    const cityOtherEl = document.getElementById("cityOther");
    const vehicleMakerEl = document.getElementById("vehicleMaker");
    const vehicleModelEl = document.getElementById("vehicleModel");
    const workVehicleStatusEls = document.querySelectorAll('input[name="workVehicleStatus"]');

    const hospitalInsuranceEl = document.getElementById("hospitalInsurance");
    const contactEmailEl = document.getElementById("contactEmail");
    const contactLineNameEl = document.getElementById("contactLineName");

    const agreeTermsEl = document.getElementById("agreeTerms");
    const agreeLabelEl = document.getElementById("agreeLabel");
    const submitBtn = document.getElementById("submitBtn");
    const submitHintEl = document.getElementById("submitHint");

    const profileEl = document.getElementById("profile");
    const profileCounterEl = document.getElementById("profileCounter");

    const errorBox = document.getElementById("errorBox");
    const errorListEl = document.getElementById("errorList");
    const networkErrorBox = document.getElementById("networkErrorBox");
    const btnLineFallback = document.getElementById("btnLineFallback");

    const successBox = document.getElementById("successBox");
    const receiptIdEl = document.getElementById("receiptId");
    const publicSummaryEl = document.getElementById("publicSummary");
    const btnResetForm = document.getElementById("btnResetForm");

    let lastReceiptId = "";
    let lastPayload = null;
    let hasTriedSubmit = false;

    cityEl.addEventListener("change", function () {
      if (cityEl.value === "その他") cityOtherRow.style.display = "";
      else { cityOtherRow.style.display = "none"; cityOtherEl.value = ""; }
      updateSubmitHint();
      if (hasTriedSubmit) validateAndPaint_();
    });

    // maker -> vehicle datalist update
    if (vehicleMakerEl && vehicleModelEl && window.DriversRegister && window.DriversRegister.updatePurchaseModelDatalist) {
      var datalistEl = document.getElementById("vehicleModelList");
      window.DriversRegister.updatePurchaseModelDatalist(vehicleMakerEl, datalistEl);
      vehicleMakerEl.addEventListener("change", function () {
        window.DriversRegister.updatePurchaseModelDatalist(vehicleMakerEl, datalistEl);
        updateSubmitHint();
        if (hasTriedSubmit) validateAndPaint_();
      });
    }

    if (cityOtherEl) cityOtherEl.addEventListener("input", function(){ updateSubmitHint(); if (hasTriedSubmit) validateAndPaint_(); });

    if (profileEl && profileCounterEl) {
      profileEl.addEventListener("input", function () {
        profileCounterEl.textContent = (profileEl.value || "").length + " 文字";
      });
    }

    function getWorkVehicleStatus() {
      var v = "";
      workVehicleStatusEls.forEach(function(el){ if (el.checked) v = el.value; });
      return v;
    }

    function clearValidationUI_() {
      document.querySelectorAll(".is-invalid").forEach(function(el){
        el.classList.remove("is-invalid");
        try { el.removeAttribute("aria-invalid"); } catch(_) {}
      });
      document.querySelectorAll(".field-error-text").forEach(function(el){ el.remove(); });
      if (agreeLabelEl) agreeLabelEl.classList.remove("is-invalid");
    }

    function addFieldError_(el, msg) {
      if (!el) return;
      el.classList.add("is-invalid");
      el.setAttribute("aria-invalid", "true");
      if (msg) {
        var div = document.createElement("div");
        div.className = "field-error-text";
        div.textContent = msg;
        el.insertAdjacentElement("afterend", div);
      }
    }

    function addAgreeError_(msg){
      if (agreeTermsEl) {
        agreeTermsEl.classList.add("is-invalid");
        agreeTermsEl.setAttribute("aria-invalid", "true");
      }
      if (agreeLabelEl) agreeLabelEl.classList.add("is-invalid");

      var div = document.createElement("div");
      div.className = "field-error-text";
      div.textContent = msg || "同意にチェックを入れてください。";
      if (agreeLabelEl) agreeLabelEl.insertAdjacentElement("afterend", div);
    }

    function makeReceiptId() {
      var ts = Date.now().toString(36);
      var r = Math.floor(Math.random() * 1e6).toString(36).padStart(4, "0");
      return "DR-" + ts + "-" + r;
    }

    function buildPayload_(paintUI) {
      const errors = [];
      let firstInvalid = null;

      function setFirst(el){ if(!firstInvalid && el) firstInvalid = el; }

      var nickname = (nicknameEl.value || "").trim();
      if (!nickname) {
        errors.push("ニックネームを入力してください。");
        if (paintUI) { addFieldError_(nicknameEl, "必須です"); setFirst(nicknameEl); }
      }

      var city = (cityEl.value || "");
      if (!city) {
        errors.push("拠点の市町村を選択してください。");
        if (paintUI) { addFieldError_(cityEl, "必須です"); setFirst(cityEl); }
      }
      if (city === "その他") {
        var other = (cityOtherEl.value || "").trim();
        if (!other) {
          errors.push("その他の市町村名を入力してください。");
          if (paintUI) {
            cityOtherRow.style.display = "";
            addFieldError_(cityOtherEl, "必須です");
            setFirst(cityOtherEl);
          }
        } else {
          city = "その他：" + other;
        }
      }

      var vehicleMaker = (vehicleMakerEl && vehicleMakerEl.value || "").trim();
      var vehicleModel = (vehicleModelEl && vehicleModelEl.value || "").trim();
      if (!vehicleMaker) {
        errors.push("メーカーを選択してください。");
        if (paintUI && vehicleMakerEl) { addFieldError_(vehicleMakerEl, "必須です"); setFirst(vehicleMakerEl); }
      }
      if (!vehicleModel) {
        errors.push("車種を入力してください。");
        if (paintUI && vehicleModelEl) { addFieldError_(vehicleModelEl, "必須です"); setFirst(vehicleModelEl); }
      }

      var workVehicleStatus = getWorkVehicleStatus();
      if (!workVehicleStatus) {
        errors.push("仕事用の車（黒ナンバー）状況を選択してください。");
        if (paintUI) { addFieldError_(document.getElementById("workVehicleStatusRow"), "必須です"); setFirst(document.getElementById("workVehicleStatusRow")); }
      }

      var hospitalChecked = hospitalInsuranceEl && hospitalInsuranceEl.checked;
      if (!hospitalChecked) {
        errors.push("入院保険に加入しています（証拠不要）にチェックを入れてください。");
        if (paintUI) {
          var row = document.getElementById("hospitalInsuranceLabel");
          if (row) { addFieldError_(row, "必須です"); setFirst(hospitalInsuranceEl); }
        }
      }

      var contactEmail = (contactEmailEl.value || "").trim();
      var contactLineName = (contactLineNameEl.value || "").trim();
      if (!contactEmail && !contactLineName) {
        errors.push("連絡先（メール or LINE表示名）のどちらかを入力してください。");
        if (paintUI) {
          addFieldError_(contactEmailEl);
          addFieldError_(contactLineNameEl, "どちらか必須です");
          setFirst(contactEmailEl);
        }
      }

      if (!agreeTermsEl.checked) {
        errors.push("同意にチェックを入れてください。");
        if (paintUI) { addAgreeError_("必須です"); setFirst(agreeTermsEl); }
      }

      var payload = {
        nickname: nickname,
        city: city,
        vehicleMaker: vehicleMaker,
        vehicleModel: vehicleModel,
        workVehicleStatus: workVehicleStatus,
        hospitalInsurance: hospitalChecked,
        autoInsurance: hospitalChecked ? "加入" : "",
        contactEmail: contactEmail,
        contactLineName: contactLineName,
        messageToTake: (document.getElementById("messageToTake").value || "").trim(),
        profile: (document.getElementById("profile").value || "").trim(),
        dispatchHope: (document.getElementById("dispatchHope").value || "").trim(),
        ngText: (document.getElementById("ngText").value || "").trim(),
        consent: agreeTermsEl.checked ? "同意済み" : "",
        userAgent: navigator.userAgent || "",
        source: "drivers-site",
        createdAt: new Date().toISOString()
      };

      return { payload: payload, errors: errors, firstInvalidEl: firstInvalid };
    }

    function validateAndPaint_(){
      clearValidationUI_();
      buildPayload_(true);
    }

    function updateSubmitHint() {
      var missing = [];

      if (!(nicknameEl.value || "").trim()) missing.push("ニックネーム");

      var city = (cityEl.value || "");
      var cityOk = false;
      if (city && city !== "その他") cityOk = true;
      if (city === "その他" && (cityOtherEl.value || "").trim()) cityOk = true;
      if (!cityOk) missing.push("市町村");

      if (!(vehicleMakerEl && vehicleMakerEl.value && vehicleModelEl && vehicleModelEl.value.trim())) missing.push("メーカー・車種");

      if (!getWorkVehicleStatus()) missing.push("黒ナンバー状況");

      if (!(hospitalInsuranceEl && hospitalInsuranceEl.checked)) missing.push("入院保険チェック");

      var mail = (contactEmailEl.value || "").trim();
      var line = (contactLineNameEl.value || "").trim();
      if (!(mail || line)) missing.push("連絡先(メールorLINE)");

      if (!(agreeTermsEl && agreeTermsEl.checked)) missing.push("同意チェック");

      if (!submitHintEl) return;
      if (missing.length === 0) {
        submitHintEl.textContent = "必須OK。仮登録できます。";
        submitBtn.classList.remove("is-disabled");
        submitBtn.setAttribute("aria-disabled", "false");
      } else {
        submitHintEl.textContent = "未入力： " + missing.join(" / ");
        submitBtn.classList.add("is-disabled");
        submitBtn.setAttribute("aria-disabled", "true");
      }
    }

    ["input","change"].forEach(function(ev){
      nicknameEl.addEventListener(ev, function(){ updateSubmitHint(); if (hasTriedSubmit) validateAndPaint_(); });
      if (vehicleMakerEl) vehicleMakerEl.addEventListener(ev, function(){ updateSubmitHint(); if (hasTriedSubmit) validateAndPaint_(); });
      if (vehicleModelEl) vehicleModelEl.addEventListener(ev, function(){ updateSubmitHint(); if (hasTriedSubmit) validateAndPaint_(); });
      workVehicleStatusEls.forEach(function(el){ el.addEventListener(ev, function(){ updateSubmitHint(); if (hasTriedSubmit) validateAndPaint_(); }); });

      if (hospitalInsuranceEl) hospitalInsuranceEl.addEventListener(ev, function(){ updateSubmitHint(); if (hasTriedSubmit) validateAndPaint_(); });

      contactEmailEl.addEventListener(ev, function(){ updateSubmitHint(); if (hasTriedSubmit) validateAndPaint_(); });
      contactLineNameEl.addEventListener(ev, function(){ updateSubmitHint(); if (hasTriedSubmit) validateAndPaint_(); });

      agreeTermsEl.addEventListener(ev, function(){ updateSubmitHint(); if (hasTriedSubmit) validateAndPaint_(); });
    });
    updateSubmitHint();

    function buildLineText(receiptId, payload) {
      var lines = [];
      lines.push("【協力ドライバー 仮登録】");
      lines.push("受付番号：" + receiptId);
      lines.push("ニックネーム：" + (payload.nickname || ""));
      lines.push("市町村：" + (payload.city || ""));
      lines.push("車種：" + (payload.vehicleMaker || "") + " " + (payload.vehicleModel || ""));
      lines.push("黒ナンバー：" + (payload.workVehicleStatus || ""));
      lines.push("連絡先：");
      if (payload.contactEmail) lines.push("・メール：" + payload.contactEmail);
      if (payload.contactLineName) lines.push("・LINE表示名：" + payload.contactLineName);
      if (payload.messageToTake) lines.push("伝えたいこと：" + payload.messageToTake);
      if (payload.profile) lines.push("ひとこと：" + payload.profile);
      if (payload.dispatchHope) lines.push("配車希望：" + payload.dispatchHope);
      if (payload.ngText) lines.push("NG条件：" + payload.ngText);
      lines.push("同意：" + (payload.consent || "未同意"));
      return lines.join("\n").slice(0, 4500);
    }

    function renderSummary(payload) {
      publicSummaryEl.innerHTML = "";
      var lines = [];
      lines.push("ニックネーム：" + payload.nickname);
      lines.push("市町村：" + payload.city);
      lines.push("車種：" + (payload.vehicleMaker || "") + " " + (payload.vehicleModel || ""));
      lines.push("黒ナンバー：" + (payload.workVehicleStatus || ""));
      lines.push("メール：" + (payload.contactEmail || "—"));
      lines.push("LINE表示名：" + (payload.contactLineName || "—"));
      lines.push("入院保険：" + (payload.hospitalInsurance ? "加入" : "—"));
      if (payload.messageToTake) lines.push("伝えたいこと：" + payload.messageToTake);
      if (payload.profile) lines.push("ひとこと：" + payload.profile);
      if (payload.dispatchHope) lines.push("配車希望：" + payload.dispatchHope);
      if (payload.ngText) lines.push("NG条件：" + payload.ngText);
      lines.push("同意：" + (payload.consent || "未同意"));

      lines.forEach(function (t) {
        var li = document.createElement("li");
        li.textContent = t;
        publicSummaryEl.appendChild(li);
      });
    }

    document.getElementById("registerForm").addEventListener("submit", function (e) {
      e.preventDefault();

      hasTriedSubmit = true;
      clearValidationUI_();

      errorBox.style.display = "none";
      errorListEl.innerHTML = "";
      networkErrorBox.style.display = "none";
      successBox.style.display = "none";

      var result = buildPayload_(true);

      if (result.errors.length > 0) {
        result.errors.forEach(function (msg) {
          var li = document.createElement("li");
          li.textContent = msg;
          errorListEl.appendChild(li);
        });
        errorBox.style.display = "";
        var target = result.firstInvalidEl || errorBox;
        if (target && target.scrollIntoView) target.scrollIntoView({ behavior: "smooth", block: "center" });
        try { (result.firstInvalidEl || nicknameEl).focus({ preventScroll: true }); } catch(_) {}
        return;
      }

      var endpoint = (window.CONFIG && window.CONFIG.GAS_ENDPOINT) || "";
      if (!endpoint || endpoint === "あとで貼る") {
        networkErrorBox.style.display = "";
        networkErrorBox.scrollIntoView({ behavior: "smooth", block: "center" });
        return;
      }

      lastReceiptId = makeReceiptId();
      lastPayload = result.payload;

      submitBtn.disabled = true;
      var originalText = submitBtn.textContent;
      submitBtn.textContent = "送信中…";

      var bodyObj = {
        type: "driver_register",
        receiptId: lastReceiptId,
        data: result.payload,
        files: {}
      };

      fetch(endpoint, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "text/plain" },
        body: JSON.stringify(bodyObj)
      }).then(function(){
        receiptIdEl.textContent = lastReceiptId;
        renderSummary(result.payload);
        successBox.style.display = "";
        successBox.scrollIntoView({ behavior: "smooth", block: "start" });
      }).catch(function(){
        networkErrorBox.style.display = "";
        networkErrorBox.scrollIntoView({ behavior: "smooth", block: "center" });
      }).finally(function(){
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
        updateSubmitHint();
      });
    });

    btnLineFallback.addEventListener("click", function () {
      var result = buildPayload_(false);
      var rid = lastReceiptId || makeReceiptId();
      var text = buildLineText(rid, result.payload || {});
      openLineShareWithText(text);
    });

    btnResetForm.addEventListener("click", function () {
      document.getElementById("registerForm").reset();
      if (profileCounterEl) profileCounterEl.textContent = "0 文字";
      cityOtherRow.style.display = "none";
      clearValidationUI_();
      errorBox.style.display = "none";
      networkErrorBox.style.display = "none";
      successBox.style.display = "none";
      lastReceiptId = "";
      lastPayload = null;
      hasTriedSubmit = false;
      updateSubmitHint();
      window.scrollTo({ top: 0, behavior: "smooth" });
    });

    document.addEventListener('mousemove', (e) => {
      document.querySelectorAll('.glass-card').forEach(card => {
        const rect = card.getBoundingClientRect();
        card.style.setProperty('--mouse-x', `${e.clientX - rect.left}px`);
        card.style.setProperty('--mouse-y', `${e.clientY - rect.top}px`);
      });
    });

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('reveal-visible');
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.05, rootMargin: "0px 0px -40px 0px" });
    document.querySelectorAll('.reveal-hidden').forEach(el => observer.observe(el));

    (function initNavOverlay() {
      var overlay = document.getElementById("nav-overlay");
      var toggle = document.getElementById("menu-toggle");
      var closeBtn = document.getElementById("menu-close");
      if (!overlay || !toggle) return;
      function openMenu() { overlay.setAttribute("aria-hidden", "false"); toggle.setAttribute("aria-expanded", "true"); }
      function closeMenu() { overlay.setAttribute("aria-hidden", "true"); toggle.setAttribute("aria-expanded", "false"); }
      toggle.addEventListener("click", function() { overlay.getAttribute("aria-hidden") === "true" ? openMenu() : closeMenu(); });
      if (closeBtn) closeBtn.addEventListener("click", closeMenu);
      overlay.querySelectorAll("a").forEach(function(a) { a.addEventListener("click", closeMenu); });
      document.addEventListener("keydown", function(e) { if (e.key === "Escape") closeMenu(); });
    })();
  </script>
  <script defer src="./assets/sakura.js"></script>
</body>
</html>
