<!doctype html>
<html lang="ja" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>本登録（本人確認）｜協力ドライバー登録｜drivers-site（山口県）</title>
  <meta name="description" content="協力ドライバーの本登録（本人確認）フォーム。氏名・住所・免許証・顔写真・任意保険証券・車両写真などを提出します。" />
  <meta name="robots" content="noindex,nofollow" />
  <link rel="canonical" href="https://takeshimonoseki.github.io/main-register.html" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

  <!-- Tailwind CSS (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { deep: '#050505', muted: '#94A3B8' },
          fontFamily: { sans: ['Inter', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] }
        }
      }
    }
  </script>

  <link rel="stylesheet" href="./drivers.css" />
  <link rel="stylesheet" href="./assets/sakura.css" />
  <script src="./config.js"></script>
  <script src="./drivers.js" defer></script>

  <!-- Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    .field-input {
      width: 100%;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 10px 14px;
      color: white;
      font-size: 14px;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .field-input:focus {
      outline: none;
      border-color: rgba(56,189,248,0.5);
      box-shadow: 0 0 0 3px rgba(56,189,248,0.1);
    }
    .field-input::placeholder { color: rgba(255,255,255,0.25); }
    select.field-input { appearance: none; cursor: pointer; }
    select.field-input option { background: #1e293b; color: white; }
    textarea.field-input { resize: vertical; min-height: 80px; }

    .is-invalid { border-color: rgba(239,68,68,0.6) !important; }
    .is-invalid:focus { box-shadow: 0 0 0 3px rgba(239,68,68,0.15) !important; }
    .field-error-text { color: #f87171; font-size: 12px; margin-top: 4px; }

    .error-banner {
      padding: 16px; border-radius: 16px;
      background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3);
      color: #fca5a5; font-size: 14px;
    }
    .error-banner strong { color: #f87171; }
    .error-banner ul { margin-top: 8px; padding-left: 18px; }
    .error-banner li { margin-bottom: 4px; }

    .success-banner {
      padding: 20px; border-radius: 16px;
      background: rgba(34,197,94,0.1); border: 1px solid rgba(34,197,94,0.3);
      color: #86efac; font-size: 14px;
    }
    .success-banner strong { color: #4ade80; }

    .summary-list { list-style: none; padding: 0; margin-top: 8px; }
    .summary-list li {
      padding: 6px 0; border-bottom: 1px solid rgba(255,255,255,0.05);
      font-size: 13px; color: rgba(255,255,255,0.7);
    }

    .terms-box {
      padding: 16px; border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.1);
      background: rgba(255,255,255,0.02);
    }
    .terms-box .terms-title { font-weight: 800; font-size: 14px; margin-bottom: 8px; }
    .terms-box .terms-list { padding-left: 18px; font-size: 13px; color: rgba(255,255,255,0.6); }
    .terms-box .terms-list li { margin-bottom: 6px; }
    .terms-box .terms-note { font-size: 12px; color: rgba(255,255,255,0.4); margin-top: 8px; }
    .terms-box .terms-note a { color: #38bdf8; text-decoration: underline; }

    #agreeLabel { font-size: 13px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; }
    #agreeLabel.is-invalid { color: #f87171; }
    #agreeLabel input { accent-color: #38bdf8; }

    .submit-hint { font-size: 12px; color: rgba(255,255,255,0.4); margin-bottom: 8px; }
    .is-disabled { opacity: 0.4; pointer-events: none; }
  </style>
</head>
<body class="bg-deep text-white min-h-screen">

  <!-- HEADER -->
  <header class="fixed top-0 w-full z-50 bg-deep/80 backdrop-blur-xl border-b border-white/5">
    <div class="header-inner max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
      <a href="./index.html" class="flex items-center gap-3 group">
        <div class="hidden sm:flex flex-col items-center justify-center px-3 py-1 bg-white/5 border border-white/10 rounded-full" aria-label="対応地域">
          <div class="text-[9px] tracking-widest font-extrabold text-white/80" id="regionEn">YAMAGUCHI</div>
          <div class="text-[9px] font-bold text-white/50" id="regionJa">山口県</div>
        </div>
        <div class="w-9 h-9 rounded-xl bg-gradient-to-br from-red-900 to-red-500 flex items-center justify-center shadow-lg shadow-red-900/30" aria-hidden="true">
          <span class="w-4 h-4 rounded-full border-2 border-white/90"></span>
        </div>
        <div>
          <div class="text-sm font-black tracking-wide leading-none" id="companyName">軽貨物TAKE</div>
          <div class="text-[10px] text-muted font-bold font-mono mt-0.5">FULL REGISTRATION</div>
        </div>
      </a>

      <div class="flex items-center gap-4">
        <div class="hidden lg:flex items-center gap-3 text-xs text-muted" aria-label="連絡先">
          <a href="https://line.me/R/ti/p/%40277rcesk" id="headerLineLink" data-line-ui="1" class="hover:text-white transition-colors" target="_blank" rel="noopener noreferrer">LINE</a>
          <span class="text-white/20">|</span>
          <a href="#" id="headerMailLink" class="hover:text-white transition-colors">takeshimonoseki@gmail.com</a>
        </div>

        <nav class="hidden md:flex gap-1" aria-label="メイン">
          <a href="./index.html" class="px-4 py-2 rounded-full text-xs font-bold text-muted hover:text-white hover:bg-white/5 transition-colors">トップ</a>
          <a href="./register.html" class="px-4 py-2 rounded-full text-xs font-bold text-muted hover:text-white hover:bg-white/5 transition-colors">仮登録</a>
          <a href="./main-register.html" class="px-4 py-2 rounded-full text-xs font-bold bg-white text-black shadow-lg shadow-white/10" aria-current="page">本登録</a>
        </nav>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="pt-24 pb-16 px-4 sm:px-6 lg:px-8 max-w-3xl mx-auto">

    <!-- Intro -->
    <div class="glass-card p-6 md:p-10 mb-6 reveal-hidden relative overflow-hidden">
      <div class="absolute -top-20 -right-20 w-[300px] h-[300px] bg-gradient-to-br from-blue-600/10 to-transparent rounded-full blur-3xl pointer-events-none"></div>
      <div class="relative z-10">
        <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/5 border border-white/10 text-[11px] font-bold text-muted mb-4">
          <i data-lucide="shield-check" class="w-3 h-3"></i> noindex（検索に出ません）
        </span>
        <h1 class="text-2xl sm:text-3xl font-black tracking-tight mb-3">本登録（本人確認）フォーム</h1>
        <p class="text-sm text-muted leading-relaxed mb-2">
          ここは<strong class="text-white">本人確認・安全運用</strong>のための提出フォームです。<br>
          お客さまページに公開されるのは<strong class="text-white">「公開」ラベルの項目のみ</strong>です。
        </p>
        <p class="text-xs text-white/40">
          ※性別入力はありません。<br>
          ※年齢は任意（書かなくてもOK）です。
        </p>
      </div>
    </div>

    <!-- Form Card -->
    <div class="glass-card p-6 md:p-10 reveal-hidden delay-100">
      <form id="fullRegisterForm" novalidate>

        <!-- Error Banner -->
        <div id="errorBox" class="error-banner mb-6" style="display:none;">
          <strong>送信できませんでした。</strong>
          <div class="mt-2">赤枠の項目をご確認ください。</div>
          <ul id="errorList"></ul>
        </div>

        <!-- Required Fields Box -->
        <div class="p-5 rounded-2xl border border-amber-500/20 bg-amber-500/5 mb-6">
          <div class="flex items-center gap-2 mb-5">
            <i data-lucide="zap" class="w-4 h-4 text-amber-400"></i>
            <span class="font-bold text-sm">必須（本人確認）</span>
            <span class="px-2 py-0.5 rounded-full bg-amber-500/10 text-amber-400 text-[10px] font-bold">この項目が揃うまで送信できません</span>
          </div>

          <div class="space-y-5">
            <!-- Nickname（公開） -->
            <div>
              <div class="flex items-center gap-2 mb-2">
                <label class="text-sm font-bold" for="nickname">ニックネーム（公開名）</label>
                <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-emerald-500/10 text-emerald-400">公開</span>
                <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-red-500/10 text-red-400">必須</span>
              </div>
              <input type="text" id="nickname" class="field-input" autocomplete="off" placeholder="例：やまぐち便 さん" />
            </div>

            <!-- 氏名（非公開） -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <div class="flex items-center gap-2 mb-2">
                  <label class="text-sm font-bold" for="lastName">苗字</label>
                  <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-purple-500/10 text-purple-400">非公開</span>
                  <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-red-500/10 text-red-400">必須</span>
                </div>
                <input type="text" id="lastName" class="field-input" autocomplete="family-name" placeholder="例：山田" />
              </div>
              <div>
                <div class="flex items-center gap-2 mb-2">
                  <label class="text-sm font-bold" for="firstName">名前</label>
                  <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-purple-500/10 text-purple-400">非公開</span>
                  <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-red-500/10 text-red-400">必須</span>
                </div>
                <input type="text" id="firstName" class="field-input" autocomplete="given-name" placeholder="例：太郎" />
              </div>
            </div>

            <!-- 住所（非公開） -->
            <div>
              <div class="flex items-center gap-2 mb-2">
                <label class="text-sm font-bold">住所</label>
                <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-purple-500/10 text-purple-400">非公開</span>
                <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-red-500/10 text-red-400">必須</span>
              </div>
              <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                <input type="text" id="zip" class="field-input sm:col-span-1" inputmode="numeric" placeholder="郵便番号（例：750-0000）" />
                <input type="text" id="pref" class="field-input sm:col-span-1" placeholder="都道府県（例：山口県）" />
                <input type="text" id="addrCity" class="field-input sm:col-span-1" placeholder="市区町村（例：下関市）" />
              </div>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3">
                <input type="text" id="addrLine1" class="field-input" placeholder="番地・町名（例：○○町1-2-3）" />
                <input type="text" id="addrLine2" class="field-input" placeholder="建物名・部屋番号（任意）" />
              </div>
              <div class="text-xs text-muted mt-1">年齢は任意（書かなくてOK）。</div>
            </div>

            <!-- 年齢（任意） -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <div class="flex items-center gap-2 mb-2">
                  <label class="text-sm font-bold" for="age">年齢（任意）</label>
                  <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-purple-500/10 text-purple-400">非公開</span>
                </div>
                <input type="number" id="age" class="field-input" min="0" max="120" placeholder="例：32" />
              </div>

              <div>
                <div class="flex items-center gap-2 mb-2">
                  <label class="text-sm font-bold" for="plateNumber">車のナンバー（必須）</label>
                  <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-purple-500/10 text-purple-400">非公開</span>
                  <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-red-500/10 text-red-400">必須</span>
                </div>
                <input type="text" id="plateNumber" class="field-input" autocomplete="off" placeholder="例：山口 480 あ 12-34" />
              </div>
            </div>

            <!-- 車の正面写真（ナンバー入り） -->
            <div>
              <div class="flex items-center gap-2 mb-2">
                <label class="text-sm font-bold" for="vehicleFrontPhoto">車の正面写真（ナンバーが写る）</label>
                <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-purple-500/10 text-purple-400">非公開</span>
                <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-red-500/10 text-red-400">必須</span>
              </div>
              <input type="file" id="vehicleFrontPhoto" accept="image/*" capture="environment" class="field-input" />
              <div class="text-xs text-muted mt-1">スマホなら「カメラ起動」になります。ナンバーが読めるように撮ってください。</div>
            </div>

            <!-- 顔写真 -->
            <div>
              <div class="flex items-center gap-2 mb-2">
                <label class="text-sm font-bold" for="facePhoto">顔写真</label>
                <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-purple-500/10 text-purple-400">非公開</span>
                <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-red-500/10 text-red-400">必須</span>
              </div>
              <input type="file" id="facePhoto" accept="image/*" capture="user" class="field-input" />
              <div class="text-xs text-muted mt-1">顔がはっきり写る1枚でOK（自撮り可）。</div>
            </div>

            <!-- 免許証 -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <div class="flex items-center gap-2 mb-2">
                  <label class="text-sm font-bold" for="licenseFront">免許証写真（表）</label>
                  <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-purple-500/10 text-purple-400">非公開</span>
                  <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-red-500/10 text-red-400">必須</span>
                </div>
                <input type="file" id="licenseFront" accept="image/*" capture="environment" class="field-input" />
              </div>
              <div>
                <div class="flex items-center gap-2 mb-2">
                  <label class="text-sm font-bold" for="licenseBack">免許証写真（裏）</label>
                  <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-purple-500/10 text-purple-400">非公開</span>
                  <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-red-500/10 text-red-400">必須</span>
                </div>
                <input type="file" id="licenseBack" accept="image/*" capture="environment" class="field-input" />
              </div>
            </div>

            <!-- 任意保険（自動車保険） -->
            <div>
              <div class="flex items-center gap-2 mb-2">
                <label class="text-sm font-bold" for="autoInsurance">任意保険（自動車保険）証券写真</label>
                <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-purple-500/10 text-purple-400">非公開</span>
                <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-red-500/10 text-red-400">必須</span>
              </div>
              <input type="file" id="autoInsurance" accept="image/*,application/pdf" capture="environment" class="field-input" />
              <div class="text-xs text-muted mt-1">任意保険加入が前提です。証券の写真（またはPDF）を添付してください。</div>
            </div>

            <!-- 貨物保険（任意） -->
            <div>
              <div class="flex items-center gap-2 mb-2">
                <label class="text-sm font-bold" for="cargoInsurance">貨物保険（あれば・任意）</label>
                <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-purple-500/10 text-purple-400">非公開</span>
              </div>
              <input type="file" id="cargoInsurance" accept="image/*,application/pdf" capture="environment" class="field-input" />
              <div class="text-xs text-muted mt-1">なくても送信できます（任意）。</div>
            </div>
          </div>
        </div>

        <!-- 公開プロフィール -->
        <div class="p-5 rounded-2xl border border-white/10 bg-white/[0.02]">
          <div class="flex items-center gap-2 mb-5">
            <i data-lucide="sparkles" class="w-4 h-4 text-sky-300"></i>
            <span class="font-bold text-sm">公開プロフィール</span>
            <span class="px-2 py-0.5 rounded-full bg-emerald-500/10 text-emerald-400 text-[10px] font-bold">公開</span>
          </div>

          <div class="space-y-5">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <div class="flex items-center gap-2 mb-2">
                  <label class="text-sm font-bold" for="publicCity">拠点の市町村</label>
                  <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-emerald-500/10 text-emerald-400">公開</span>
                  <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-red-500/10 text-red-400">必須</span>
                </div>
                <select id="publicCity" class="field-input">
                  <option value="">選択してください</option>
                  <option value="下関市">下関市</option>
                  <option value="北九州市">北九州市</option>
                  <option value="山口市">山口市</option>
                  <option value="宇部市">宇部市</option>
                  <option value="防府市">防府市</option>
                  <option value="周南市">周南市</option>
                  <option value="岩国市">岩国市</option>
                  <option value="光市">光市</option>
                  <option value="山陽小野田市">山陽小野田市</option>
                  <option value="萩市">萩市</option>
                  <option value="長門市">長門市</option>
                  <option value="美祢市">美祢市</option>
                  <option value="柳井市">柳井市</option>
                  <option value="田布施町">田布施町</option>
                  <option value="平生町">平生町</option>
                  <option value="その他">その他（自由入力）</option>
                </select>
              </div>

              <div id="publicCityOtherRow" style="display:none;">
                <div class="flex items-center gap-2 mb-2">
                  <label class="text-sm font-bold" for="publicCityOther">その他の市町村名</label>
                  <span class="text-xs text-muted">公開</span>
                </div>
                <input type="text" id="publicCityOther" class="field-input" placeholder="例：山口県 ○○郡 △△町" />
              </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <div class="flex items-center gap-2 mb-2">
                  <label class="text-sm font-bold" for="vehicleMaker">メーカー</label>
                  <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-emerald-500/10 text-emerald-400">公開</span>
                  <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-red-500/10 text-red-400">必須</span>
                </div>
                <select id="vehicleMaker" class="field-input">
                  <option value="">選択してください</option>
                  <option value="トヨタ">トヨタ</option>
                  <option value="ホンダ">ホンダ</option>
                  <option value="日産">日産</option>
                  <option value="スズキ">スズキ</option>
                  <option value="ダイハツ">ダイハツ</option>
                  <option value="マツダ">マツダ</option>
                  <option value="三菱">三菱</option>
                  <option value="スバル">スバル</option>
                  <option value="いすゞ">いすゞ</option>
                  <option value="その他">その他</option>
                </select>
              </div>
              <div>
                <div class="flex items-center gap-2 mb-2">
                  <label class="text-sm font-bold" for="vehicleModel">車種</label>
                  <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-emerald-500/10 text-emerald-400">公開</span>
                  <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-red-500/10 text-red-400">必須</span>
                </div>
                <input type="text" id="vehicleModel" list="vehicleModelList" class="field-input" autocomplete="off" placeholder="例：ハイゼットカーゴ／N-VAN／NV200" />
                <datalist id="vehicleModelList"></datalist>
              </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <div class="flex items-center gap-2 mb-2">
                  <label class="text-sm font-bold" for="experience">経験（任意）</label>
                  <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-emerald-500/10 text-emerald-400">公開</span>
                </div>
                <select id="experience" class="field-input">
                  <option value="">未選択</option>
                  <option value="未経験">未経験</option>
                  <option value="1年未満">1年未満</option>
                  <option value="1〜3年">1〜3年</option>
                  <option value="3年以上">3年以上</option>
                </select>
              </div>
              <div>
                <div class="flex items-center gap-2 mb-2">
                  <label class="text-sm font-bold" for="oneLine">ひとこと（任意）</label>
                  <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-emerald-500/10 text-emerald-400">公開</span>
                </div>
                <input type="text" id="oneLine" class="field-input" maxlength="60" placeholder="例：安全運転／スポット得意／夜強い など" />
              </div>
            </div>

            <div>
              <div class="flex items-center gap-2 mb-2">
                <label class="text-sm font-bold" for="tools">ツール/所属など（任意）</label>
                <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-emerald-500/10 text-emerald-400">公開</span>
              </div>
              <textarea id="tools" class="field-input" placeholder="例：PickGo／Amazon Flex／黒ナンバー／台車あり、など"></textarea>
            </div>
          </div>
        </div>

        <!-- Terms -->
        <div class="mt-6">
          <div class="terms-box" id="termsBox">
            <div class="terms-title">同意内容（必ず確認）</div>
            <ul class="terms-list">
              <li>入力内容は本人確認・登録管理のために利用します。</li>
              <li>公開されるのは「公開」ラベルの項目のみです（氏名・住所・書類画像などは公開しません）。</li>
              <li>迷惑行為・虚偽入力がある場合、以後の連絡をお断りすることがあります。</li>
            </ul>
            <div class="terms-note">
              個人情報の取り扱いは <a href="./privacy.html">プライバシー・個人情報の取扱い</a> をご確認ください。
            </div>
          </div>

          <label class="flex items-center gap-2 mt-3 text-sm font-semibold cursor-pointer" id="agreeLabel">
            <input type="checkbox" id="agreeTerms" />
            上記の同意内容に同意して本登録します（必須）
          </label>
        </div>

        <!-- Submit -->
        <div class="flex flex-col items-end gap-2 mt-6">
          <div class="submit-hint" id="submitHint" aria-live="polite"></div>
          <button type="submit" class="inline-flex items-center gap-2 px-6 py-3 rounded-2xl bg-white text-black font-bold text-sm shadow-lg shadow-white/10 hover:-translate-y-0.5 transition-all active:scale-95" id="submitBtn">
            <i data-lucide="send" class="w-4 h-4"></i> 本登録を送信する
          </button>
        </div>

        <!-- Back to pre-registration -->
        <details class="group mt-6">
          <summary class="cursor-pointer text-sm font-bold text-white/60 hover:text-white transition-colors flex items-center gap-2 select-none p-4 rounded-2xl border border-white/10 bg-white/[0.02]">
            <i data-lucide="chevron-down" class="w-4 h-4 transition-transform group-open:rotate-180"></i>
            仮登録へ戻る
          </summary>
          <div class="mt-4 p-5 rounded-2xl border border-white/5 bg-white/[0.01]">
            <a href="./register.html" class="inline-flex items-center gap-2 text-sm text-muted hover:text-white transition-colors">
              <i data-lucide="arrow-left" class="w-4 h-4"></i> まずは仮登録へ
            </a>
          </div>
        </details>
      </form>

      <!-- Network Error -->
      <div id="networkErrorBox" class="error-banner mt-6" style="display:none;">
        <strong>送信エラーが発生しました。</strong>
        <div class="mt-2">
          通信状況や設定の影響で届いていない可能性があります。<br>
          受付番号を控えて、LINEまたはメールでご連絡ください。
        </div>
        <div class="mt-2 text-sm">
          受付番号：<span id="networkReceiptId" class="font-mono text-white"></span>
        </div>
      </div>

      <!-- Success -->
      <div id="successBox" class="success-banner mt-6" style="display:none;">
        <strong>本登録を受け付けました。</strong>
        <div class="mt-2">
          受付番号：<span id="receiptId" class="font-mono text-white"></span><br>
          ステータス：<span class="font-mono text-white">受領</span>
        </div>
        <p class="text-xs text-muted mt-2">※代表たけから確認の連絡が入ります。</p>

        <div class="mt-4 p-4 rounded-xl border border-white/5 bg-white/[0.02]">
          <div class="text-xs font-bold text-muted uppercase tracking-wider mb-2">送信内容（確認用・画像は省略）</div>
          <ul id="publicSummary" class="summary-list"></ul>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="border-t border-white/5 mt-12 pt-8 pb-4 text-center">
      <div class="text-xs text-muted" id="footerCompany">drivers-site｜協力ドライバー登録プール（山口県）</div>
      <div class="text-[11px] text-white/30 mt-1">フォームからの登録に加え、LINE経由での登録内容修正・削除依頼も受け付けます。</div>
      <p class="text-[11px] text-muted mt-2"><a href="./privacy.html" class="underline underline-offset-4 decoration-white/20 hover:decoration-white/50 transition-colors">プライバシー・個人情報の取扱い</a></p>
    </footer>
  </main>

  <script>
    lucide.createIcons();

    (function applyConfig() {
      if (!window.CONFIG) return;
      var regionJa = document.getElementById("regionJa");
      var regionEn = document.getElementById("regionEn");
      var companyName = document.getElementById("companyName");
      var footerCompany = document.getElementById("footerCompany");

      if (regionJa) regionJa.textContent = window.CONFIG.REGION_LABEL || "山口県";
      if (regionEn) regionEn.textContent = (window.CONFIG.REGION_CODE || "YAMAGUCHI").toUpperCase();
      if (companyName) companyName.textContent = window.CONFIG.COMPANY_NAME || "軽貨物TAKE";
      if (footerCompany) footerCompany.textContent = (window.CONFIG.COMPANY_NAME || "drivers-site") + "｜協力ドライバー登録プール（" + (window.CONFIG.REGION_LABEL || "山口県") + "）";

      var lineUrl = window.CONFIG.LINE_URL || "https://line.me/R/ti/p/%40277rcesk";
      var lineLink = document.getElementById("headerLineLink");
      var mailLink = document.getElementById("headerMailLink");
      var email = window.CONFIG.EMAIL_TO || "";

      if (lineLink) lineLink.href = lineUrl;
      if (mailLink && email) { mailLink.href = "mailto:" + email; mailLink.textContent = email; }
    })();

    function fileToDataUrlSmart(file, opts) {
      opts = opts || {};
      var maxW = opts.maxW || 1280;
      var maxH = opts.maxH || 1280;
      var quality = typeof opts.quality === "number" ? opts.quality : 0.82;

      return new Promise(function(resolve, reject) {
        if (!file) return resolve(null);

        var reader = new FileReader();
        reader.onerror = function(){ reject(new Error("file_read_failed")); };
        reader.onload = function() {
          var dataUrl = reader.result;

          if (!/^image\//.test(file.type || "")) {
            return resolve({ name: file.name || "file", type: file.type || "application/octet-stream", dataUrl: String(dataUrl || "") });
          }

          var img = new Image();
          img.onerror = function() {
            resolve({ name: file.name || "image", type: file.type || "image/*", dataUrl: String(dataUrl || "") });
          };
          img.onload = function() {
            var w = img.naturalWidth || img.width || 0;
            var h = img.naturalHeight || img.height || 0;
            if (!w || !h) {
              return resolve({ name: file.name || "image", type: file.type || "image/*", dataUrl: String(dataUrl || "") });
            }
            var scale = Math.min(1, maxW / w, maxH / h);
            if (scale >= 1) {
              return resolve({ name: file.name || "image", type: file.type || "image/*", dataUrl: String(dataUrl || "") });
            }
            var cw = Math.max(1, Math.round(w * scale));
            var ch = Math.max(1, Math.round(h * scale));
            var canvas = document.createElement("canvas");
            canvas.width = cw;
            canvas.height = ch;
            var ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, cw, ch);
            try {
              var outDataUrl = canvas.toDataURL("image/jpeg", quality);
              var base = (file.name || "image").replace(/\.[^.]+$/, "");
              resolve({ name: base + ".jpg", type: "image/jpeg", dataUrl: outDataUrl });
            } catch (e) {
              resolve({ name: file.name || "image", type: file.type || "image/*", dataUrl: String(dataUrl || "") });
            }
          };
          img.src = String(dataUrl || "");
        };
        reader.readAsDataURL(file);
      });
    }

    // Elements
    var nicknameEl = document.getElementById("nickname");
    var lastNameEl = document.getElementById("lastName");
    var firstNameEl = document.getElementById("firstName");

    var zipEl = document.getElementById("zip");
    var prefEl = document.getElementById("pref");
    var addrCityEl = document.getElementById("addrCity");
    var addrLine1El = document.getElementById("addrLine1");
    var addrLine2El = document.getElementById("addrLine2");
    var ageEl = document.getElementById("age");

    var plateNumberEl = document.getElementById("plateNumber");
    var vehicleFrontPhotoEl = document.getElementById("vehicleFrontPhoto");

    var facePhotoEl = document.getElementById("facePhoto");
    var licenseFrontEl = document.getElementById("licenseFront");
    var licenseBackEl = document.getElementById("licenseBack");
    var autoInsuranceEl = document.getElementById("autoInsurance");
    var cargoInsuranceEl = document.getElementById("cargoInsurance");

    var publicCityEl = document.getElementById("publicCity");
    var publicCityOtherRow = document.getElementById("publicCityOtherRow");
    var publicCityOtherEl = document.getElementById("publicCityOther");

    var vehicleMakerEl = document.getElementById("vehicleMaker");
    var vehicleModelEl = document.getElementById("vehicleModel");
    var experienceEl = document.getElementById("experience");
    var oneLineEl = document.getElementById("oneLine");
    var toolsEl = document.getElementById("tools");

    var agreeTermsEl = document.getElementById("agreeTerms");
    var agreeLabelEl = document.getElementById("agreeLabel");
    var submitBtn = document.getElementById("submitBtn");
    var submitHintEl = document.getElementById("submitHint");

    var errorBox = document.getElementById("errorBox");
    var errorListEl = document.getElementById("errorList");

    var networkErrorBox = document.getElementById("networkErrorBox");
    var networkReceiptIdEl = document.getElementById("networkReceiptId");

    var successBox = document.getElementById("successBox");
    var receiptIdEl = document.getElementById("receiptId");
    var publicSummaryEl = document.getElementById("publicSummary");

    // public city other toggle
    publicCityEl.addEventListener("change", function(){
      if (publicCityEl.value === "その他") publicCityOtherRow.style.display = "";
      else { publicCityOtherRow.style.display = "none"; publicCityOtherEl.value = ""; }
      updateSubmitHint();
      if (hasTriedSubmit) validateAndPaint_();
    });
    publicCityOtherEl.addEventListener("input", function(){ updateSubmitHint(); if (hasTriedSubmit) validateAndPaint_(); });

    // maker -> vehicle datalist update
    if (vehicleMakerEl && vehicleModelEl && window.DriversRegister && window.DriversRegister.updatePurchaseModelDatalist) {
      var datalistEl = document.getElementById("vehicleModelList");
      window.DriversRegister.updatePurchaseModelDatalist(vehicleMakerEl, datalistEl);
      vehicleMakerEl.addEventListener("change", function () {
        window.DriversRegister.updatePurchaseModelDatalist(vehicleMakerEl, datalistEl);
        updateSubmitHint();
        if (hasTriedSubmit) validateAndPaint_();
      });
    }

    function clearValidationUI_() {
      document.querySelectorAll(".is-invalid").forEach(function(el){
        el.classList.remove("is-invalid");
        try { el.removeAttribute("aria-invalid"); } catch(_) {}
      });
      document.querySelectorAll(".field-error-text").forEach(function(el){ el.remove(); });
      if (agreeLabelEl) agreeLabelEl.classList.remove("is-invalid");
    }

    function addFieldError_(el, msg) {
      if (!el) return;
      el.classList.add("is-invalid");
      el.setAttribute("aria-invalid", "true");
      if (msg) {
        var div = document.createElement("div");
        div.className = "field-error-text";
        div.textContent = msg;
        el.insertAdjacentElement("afterend", div);
      }
    }

    function addAgreeError_(msg){
      if (agreeTermsEl) {
        agreeTermsEl.classList.add("is-invalid");
        agreeTermsEl.setAttribute("aria-invalid", "true");
      }
      if (agreeLabelEl) agreeLabelEl.classList.add("is-invalid");

      var div = document.createElement("div");
      div.className = "field-error-text";
      div.textContent = msg || "同意にチェックを入れてください。";
      if (agreeLabelEl) agreeLabelEl.insertAdjacentElement("afterend", div);
    }

    function makeReceiptId() {
      var ts = Date.now().toString(36);
      var r = Math.floor(Math.random() * 1e6).toString(36).padStart(4, "0");
      return "FR-" + ts + "-" + r;
    }

    var hasTriedSubmit = false;
    var lastReceiptId = "";

    function buildPayload_(paintUI) {
      var errors = [];
      var firstInvalid = null;
      function setFirst(el){ if(!firstInvalid && el) firstInvalid = el; }

      var nickname = (nicknameEl.value || "").trim();
      if (!nickname) { errors.push("ニックネームを入力してください。"); if (paintUI) { addFieldError_(nicknameEl, "必須です"); setFirst(nicknameEl); } }

      var lastName = (lastNameEl.value || "").trim();
      if (!lastName) { errors.push("苗字を入力してください。"); if (paintUI) { addFieldError_(lastNameEl, "必須です"); setFirst(lastNameEl); } }

      var firstName = (firstNameEl.value || "").trim();
      if (!firstName) { errors.push("名前を入力してください。"); if (paintUI) { addFieldError_(firstNameEl, "必須です"); setFirst(firstNameEl); } }

      var zip = (zipEl.value || "").trim();
      var pref = (prefEl.value || "").trim();
      var addrCity = (addrCityEl.value || "").trim();
      var addrLine1 = (addrLine1El.value || "").trim();
      var addrLine2 = (addrLine2El.value || "").trim();

      if (!zip) { errors.push("郵便番号を入力してください。"); if (paintUI) { addFieldError_(zipEl, "必須です"); setFirst(zipEl); } }
      if (!pref) { errors.push("都道府県を入力してください。"); if (paintUI) { addFieldError_(prefEl, "必須です"); setFirst(prefEl); } }
      if (!addrCity) { errors.push("市区町村を入力してください。"); if (paintUI) { addFieldError_(addrCityEl, "必須です"); setFirst(addrCityEl); } }
      if (!addrLine1) { errors.push("番地・町名を入力してください。"); if (paintUI) { addFieldError_(addrLine1El, "必須です"); setFirst(addrLine1El); } }

      var plateNumber = (plateNumberEl.value || "").trim();
      if (!plateNumber) { errors.push("車のナンバーを入力してください。"); if (paintUI) { addFieldError_(plateNumberEl, "必須です"); setFirst(plateNumberEl); } }

      var maxMb = (window.CONFIG && window.CONFIG.MAX_FILE_MB) ? Number(window.CONFIG.MAX_FILE_MB) : 5;
      var maxBytes = Math.max(1, maxMb) * 1024 * 1024;

      function checkFileRequired(fileEl, label) {
        var f = fileEl && fileEl.files && fileEl.files[0] ? fileEl.files[0] : null;
        if (!f) {
          errors.push(label + "を添付してください。");
          if (paintUI) { addFieldError_(fileEl, "必須です"); setFirst(fileEl); }
          return null;
        }
        if (f.size && f.size > maxBytes) {
          errors.push(label + "のファイルサイズが大きすぎます（" + maxMb + "MBまで）。撮り直し/圧縮して再添付してください。");
          if (paintUI) { addFieldError_(fileEl, "サイズ超過"); setFirst(fileEl); }
          return null;
        }
        return f;
      }

      var vehicleFrontPhotoFile = checkFileRequired(vehicleFrontPhotoEl, "車の正面写真（ナンバー入り）");
      var facePhotoFile = checkFileRequired(facePhotoEl, "顔写真");
      var licenseFrontFile = checkFileRequired(licenseFrontEl, "免許証写真（表）");
      var licenseBackFile = checkFileRequired(licenseBackEl, "免許証写真（裏）");
      var autoInsuranceFile = checkFileRequired(autoInsuranceEl, "任意保険（自動車保険）証券写真");

      var cargoInsuranceFile = cargoInsuranceEl && cargoInsuranceEl.files && cargoInsuranceEl.files[0] ? cargoInsuranceEl.files[0] : null;
      if (cargoInsuranceFile && cargoInsuranceFile.size && cargoInsuranceFile.size > maxBytes) {
        errors.push("貨物保険のファイルサイズが大きすぎます（" + maxMb + "MBまで）。");
        if (paintUI) { addFieldError_(cargoInsuranceEl, "サイズ超過"); setFirst(cargoInsuranceEl); }
        cargoInsuranceFile = null;
      }

      var publicCity = (publicCityEl.value || "");
      if (!publicCity) {
        errors.push("公開プロフィールの市町村を選択してください。");
        if (paintUI) { addFieldError_(publicCityEl, "必須です"); setFirst(publicCityEl); }
      }
      if (publicCity === "その他") {
        var pOther = (publicCityOtherEl.value || "").trim();
        if (!pOther) {
          errors.push("公開プロフィールのその他市町村名を入力してください。");
          if (paintUI) { publicCityOtherRow.style.display = ""; addFieldError_(publicCityOtherEl, "必須です"); setFirst(publicCityOtherEl); }
        } else {
          publicCity = "その他：" + pOther;
        }
      }

      var vehicleMaker = (vehicleMakerEl.value || "").trim();
      var vehicleModel = (vehicleModelEl.value || "").trim();
      if (!vehicleMaker) { errors.push("公開プロフィールのメーカーを選択してください。"); if (paintUI) { addFieldError_(vehicleMakerEl, "必須です"); setFirst(vehicleMakerEl); } }
      if (!vehicleModel) { errors.push("公開プロフィールの車種を入力してください。"); if (paintUI) { addFieldError_(vehicleModelEl, "必須です"); setFirst(vehicleModelEl); } }

      if (!agreeTermsEl.checked) { errors.push("同意にチェックを入れてください。"); if (paintUI) { addAgreeError_("必須です"); setFirst(agreeTermsEl); } }

      var age = (ageEl.value || "").trim();

      var payload = {
        nickname: nickname,
        lastName: lastName,
        firstName: firstName,
        zip: zip,
        pref: pref,
        addrCity: addrCity,
        addrLine1: addrLine1,
        addrLine2: addrLine2,
        age: age,
        plateNumber: plateNumber,
        publicCity: publicCity,
        vehicleMaker: vehicleMaker,
        vehicleModel: vehicleModel,
        experience: (experienceEl.value || "").trim(),
        oneLine: (oneLineEl.value || "").trim(),
        tools: (toolsEl.value || "").trim(),
        consent: agreeTermsEl.checked ? "同意済み" : "",
        userAgent: navigator.userAgent || "",
        source: "drivers-site",
        createdAt: new Date().toISOString()
      };

      var files = {
        vehicleFrontPhoto: vehicleFrontPhotoFile,
        facePhoto: facePhotoFile,
        licenseFront: licenseFrontFile,
        licenseBack: licenseBackFile,
        autoInsurance: autoInsuranceFile,
        cargoInsurance: cargoInsuranceFile
      };

      return { payload: payload, files: files, errors: errors, firstInvalidEl: firstInvalid };
    }

    function validateAndPaint_(){
      clearValidationUI_();
      buildPayload_(true);
    }

    function updateSubmitHint() {
      var missing = [];

      if (!(nicknameEl.value || "").trim()) missing.push("ニックネーム");
      if (!(lastNameEl.value || "").trim()) missing.push("苗字");
      if (!(firstNameEl.value || "").trim()) missing.push("名前");
      if (!(zipEl.value || "").trim()) missing.push("郵便番号");
      if (!(prefEl.value || "").trim()) missing.push("都道府県");
      if (!(addrCityEl.value || "").trim()) missing.push("市区町村");
      if (!(addrLine1El.value || "").trim()) missing.push("番地");
      if (!(plateNumberEl.value || "").trim()) missing.push("車のナンバー");

      if (!(vehicleFrontPhotoEl.files && vehicleFrontPhotoEl.files.length)) missing.push("車正面写真");
      if (!(facePhotoEl.files && facePhotoEl.files.length)) missing.push("顔写真");
      if (!(licenseFrontEl.files && licenseFrontEl.files.length)) missing.push("免許証表");
      if (!(licenseBackEl.files && licenseBackEl.files.length)) missing.push("免許証裏");
      if (!(autoInsuranceEl.files && autoInsuranceEl.files.length)) missing.push("任意保険");

      var pubCity = (publicCityEl.value || "");
      var pubCityOk = false;
      if (pubCity && pubCity !== "その他") pubCityOk = true;
      if (pubCity === "その他" && (publicCityOtherEl.value || "").trim()) pubCityOk = true;
      if (!pubCityOk) missing.push("公開市町村");

      if (!(vehicleMakerEl.value || "").trim() || !(vehicleModelEl.value || "").trim()) missing.push("公開車種");

      if (!(agreeTermsEl && agreeTermsEl.checked)) missing.push("同意チェック");

      if (!submitHintEl) return;
      if (missing.length === 0) {
        submitHintEl.textContent = "必須OK。本登録を送信できます。";
        submitBtn.classList.remove("is-disabled");
        submitBtn.setAttribute("aria-disabled", "false");
      } else {
        submitHintEl.textContent = "未入力： " + missing.join(" / ");
        submitBtn.classList.add("is-disabled");
        submitBtn.setAttribute("aria-disabled", "true");
      }
    }

    ["input","change"].forEach(function(ev){
      [nicknameEl,lastNameEl,firstNameEl,zipEl,prefEl,addrCityEl,addrLine1El,addrLine2El,ageEl,plateNumberEl,
       vehicleFrontPhotoEl,facePhotoEl,licenseFrontEl,licenseBackEl,autoInsuranceEl,cargoInsuranceEl,
       publicCityEl,publicCityOtherEl,vehicleMakerEl,vehicleModelEl,experienceEl,oneLineEl,toolsEl,agreeTermsEl].forEach(function(el){
        if (el) el.addEventListener(ev, function(){ updateSubmitHint(); if (hasTriedSubmit) validateAndPaint_(); });
      });
    });
    updateSubmitHint();

    function renderSummary(payload, files) {
      publicSummaryEl.innerHTML = "";
      var lines = [];
      lines.push("ニックネーム：" + payload.nickname);
      lines.push("氏名：" + payload.lastName + " " + payload.firstName + "（非公開）");
      lines.push("住所：入力済み（非公開）");
      lines.push("年齢：" + (payload.age || "—（未入力）"));
      lines.push("車ナンバー：" + payload.plateNumber + "（非公開）");
      lines.push("公開市町村：" + payload.publicCity);
      lines.push("公開車種：" + payload.vehicleMaker + " " + payload.vehicleModel);
      if (payload.experience) lines.push("経験：" + payload.experience);
      if (payload.oneLine) lines.push("ひとこと：" + payload.oneLine);
      if (payload.tools) lines.push("ツール等：" + payload.tools);
      lines.push("添付：" +
        (files.facePhoto ? "顔写真" : "") + " / " +
        (files.licenseFront ? "免許証表" : "") + " / " +
        (files.licenseBack ? "免許証裏" : "") + " / " +
        (files.autoInsurance ? "任意保険" : "") + " / " +
        (files.vehicleFrontPhoto ? "車正面" : "") +
        (files.cargoInsurance ? " / 貨物保険" : "")
      );

      lines.forEach(function (t) {
        var li = document.createElement("li");
        li.textContent = t;
        publicSummaryEl.appendChild(li);
      });
    }

    document.getElementById("fullRegisterForm").addEventListener("submit", function(e){
      e.preventDefault();

      hasTriedSubmit = true;
      clearValidationUI_();
      errorBox.style.display = "none";
      errorListEl.innerHTML = "";
      networkErrorBox.style.display = "none";
      successBox.style.display = "none";

      var result = buildPayload_(true);
      if (result.errors.length > 0) {
        result.errors.forEach(function(msg){
          var li = document.createElement("li");
          li.textContent = msg;
          errorListEl.appendChild(li);
        });
        errorBox.style.display = "";
        var target = result.firstInvalidEl || errorBox;
        if (target && target.scrollIntoView) target.scrollIntoView({ behavior: "smooth", block: "center" });
        try { (result.firstInvalidEl || nicknameEl).focus({ preventScroll: true }); } catch(_) {}
        return;
      }

      var endpoint = (window.CONFIG && window.CONFIG.GAS_ENDPOINT) || "";
      if (!endpoint || endpoint === "あとで貼る") {
        lastReceiptId = makeReceiptId();
        networkReceiptIdEl.textContent = lastReceiptId;
        networkErrorBox.style.display = "";
        networkErrorBox.scrollIntoView({ behavior: "smooth", block: "center" });
        return;
      }

      lastReceiptId = makeReceiptId();
      submitBtn.disabled = true;
      var originalText = submitBtn.textContent;
      submitBtn.textContent = "送信中…";

      // files -> dataUrl
      var fileKeys = ["vehicleFrontPhoto","facePhoto","licenseFront","licenseBack","autoInsurance","cargoInsurance"];
      var promises = fileKeys.map(function(k){
        var f = result.files[k] || null;
        if (!f) return Promise.resolve([k, null]);
        return fileToDataUrlSmart(f, { maxW: 1280, maxH: 1280, quality: 0.82 }).then(function(obj){ return [k, obj]; });
      });

      Promise.all(promises).then(function(entries){
        var filesObj = {};
        entries.forEach(function(pair){
          var k = pair[0];
          var v = pair[1];
          if (v) filesObj[k] = v;
        });

        var bodyObj = {
          type: "driver_full_register",
          receiptId: lastReceiptId,
          data: result.payload,
          files: filesObj
        };

        return fetch(endpoint, {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "text/plain" },
          body: JSON.stringify(bodyObj)
        }).then(function(){
          window.location.href = "thankyou.html?receiptId=" + encodeURIComponent(lastReceiptId);
        });
      }).catch(function(){
        networkReceiptIdEl.textContent = lastReceiptId;
        networkErrorBox.style.display = "";
        networkErrorBox.scrollIntoView({ behavior: "smooth", block: "center" });
      }).finally(function(){
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
        updateSubmitHint();
      });
    });

    document.addEventListener('mousemove', (e) => {
      document.querySelectorAll('.glass-card').forEach(card => {
        const rect = card.getBoundingClientRect();
        card.style.setProperty('--mouse-x', `${e.clientX - rect.left}px`);
        card.style.setProperty('--mouse-y', `${e.clientY - rect.top}px`);
      });
    });

    var observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('reveal-visible');
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.05, rootMargin: "0px 0px -40px 0px" });
    document.querySelectorAll('.reveal-hidden').forEach(el => observer.observe(el));
  </script>
  <script defer src="./assets/sakura.js"></script>
</body>
</html>
