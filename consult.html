<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>相談スタート｜drivers-site（山口県）</title>
  <meta name="description" content="どの相談から始めるか選び、内容をまとめてLINEの送信欄に下書きとして入れます。" />
  <link rel="stylesheet" href="./drivers.css" />
  <script src="./config.js"></script>
</head>
<body>
  <div id="top"></div>

  <header class="site-header">
    <div class="site-header-inner">
      <div class="header-left">
        <a class="brand" href="./index.html">
          <span class="brand-badge" aria-hidden="true">YAMAGUCHI<br>山口県</span>
          <span class="brand-text">
            <span class="brand-title" id="companyName">軽貨物TAKE</span>
            <span class="brand-sub">協力ドライバー登録サイト</span>
          </span>
        </a>
      </div>

      <div class="header-right">
        <div class="contact-strip" aria-label="連絡先">
          <a class="mini-link" id="headerLineLink" href="./consult.html">相談する</a>
          <a class="mini-link" id="headerMailLink" href="#">MAIL</a>
          <a class="mini-link" id="headerTelLink" href="#">TEL</a>
        </div>

        <nav class="nav" aria-label="メイン">
          <a href="./index.html" class="nav-link">トップ</a>
          <a href="./consult.html" class="nav-link nav-link-primary" aria-current="page">開業相談</a>
          <a href="./vehicle.html" class="nav-link">車両の相談</a>
          <a href="./register.html" class="nav-link">登録</a>
        </nav>
      </div>
    </div>
  </header>

  <main class="page">

      <article class="card" style="margin-bottom: 14px;">
        <div class="card-inner">
          <h1 class="hero-title" style="margin:0 0 6px;">相談スタート</h1>
          <p class="hero-lead" style="margin:0;">
            選んだ内容＋備考をまとめて、LINEの送信欄に<strong>下書き</strong>として入れます。送信ボタンはあなたが押します。
          </p>
        </div>
      </article>

      <!-- ✅ 最優先：登録へ誘導 -->
      <article class="card" style="margin-bottom: 14px;">
        <div class="card-inner">
          <div class="pill" style="display:inline-flex; gap:8px; align-items:center; margin-bottom:8px;">
            <span class="badge badge-ok">最優先</span>
            <span class="muted">協力ドライバー登録</span>
          </div>
          <h2 class="section-title" style="margin:0 0 8px;">まず登録フォームへ（1分）</h2>
          <p class="muted" style="margin:0 0 12px;">登録が一番うれしいので、相談より先にここだけでもOKです。</p>
          <a class="btn btn-primary" href="./register.html">協力ドライバー登録フォームへ</a>
        </div>
      </article>

      <!-- ✅ 相談：選択→生成→確認→送る -->
      <article class="card" id="consultCard">
        <div class="card-inner">
          <h2 class="section-title" style="margin:0 0 10px;">LINEで相談（内容付き）</h2>

          <div class="columns" style="margin-top: 6px;">
            <section>
              <h3 class="section-title" style="margin:0 0 10px; font-size:16px;">① 相談カテゴリを選ぶ</h3>
              <div class="radio-row" style="display:grid; gap:10px;">
                <label>
                  <input type="radio" name="consultType" value="協力ドライバー登録について" checked>
                  <span><b>協力ドライバー登録について</b><br><span class="muted">登録の流れ／公開範囲／稼働条件など</span></span>
                </label>
                <label>
                  <input type="radio" name="consultType" value="開業トータル相談">
                  <span><b>開業トータル相談</b><br><span class="muted">車両・黒ナンバー・保険・確定申告など全体整理</span></span>
                </label>
                <label>
                  <input type="radio" name="consultType" value="車両購入の相談">
                  <span><b>車両購入の相談</b><br><span class="muted">おすすめ／予算／リース・中古／選び方</span></span>
                </label>
                <label>
                  <input type="radio" name="consultType" value="修理整備の相談">
                  <span><b>修理整備の相談</b><br><span class="muted">症状／見積／整備先の相談</span></span>
                </label>
                <label>
                  <input type="radio" name="consultType" value="その他（クルマ相談）">
                  <span><b>その他（クルマ相談）</b><br><span class="muted">車検・保険・名義・雑談まで</span></span>
                </label>
              </div>

              <div style="margin-top: 12px;">
                <h3 class="section-title" style="margin:0 0 8px; font-size:16px;">② 備考（自由入力）</h3>
                <textarea id="note" class="field" rows="7" placeholder="例）\n・今の状況：未経験／準備中／稼働中\n・希望エリア：〇〇\n・予算感：〇〇\n・困っていること：〇〇\n（ここは例です。送信本文には混ざりません）"></textarea>

                <details style="margin-top:10px;">
                  <summary class="muted">相談例（参考・送信本文には入りません）</summary>
                  <ul class="muted" style="margin:8px 0 0; padding-left: 18px;">
                    <li>開業に必要な手順を、最短で整理してほしい</li>
                    <li>黒ナンバー取得の流れと必要書類を教えてほしい</li>
                    <li>軽バン（中古/リース）のおすすめと相場感を知りたい</li>
                    <li>この症状（異音/警告灯）って修理必要？目安いくら？</li>
                    <li>協力ドライバー登録の流れと公開範囲を確認したい</li>
                  </ul>
                </details>
              </div>

              <div class="actions" style="margin-top: 14px;">
                <a class="btn btn-secondary" id="btnAddFriend" href="#" target="_blank" rel="noopener noreferrer">まず友だち追加</a>
                <button class="btn btn-line" type="button" id="btnBuild">この内容で作る</button>
              </div>

              <p class="muted" style="margin: 10px 0 0;">
                ※ 送信日時は入れません（LINE側で分かるため）。
              </p>
            </section>

            <section>
              <h3 class="section-title" style="margin:0 0 10px; font-size:16px;">③ 確認して送る</h3>
              <div id="previewBox" class="card" style="display:none;">
                <div class="card-inner">
                  <div class="muted" style="margin-bottom:8px;">この内容がLINEの入力欄に入ります（送信はあなたが押します）</div>
                  <pre id="previewText" style="white-space:pre-wrap; margin:0; font-size:14px; line-height:1.6;"></pre>

                  <div class="actions" style="margin-top: 12px;">
                    <button class="btn btn-secondary" type="button" id="btnEdit">修正する</button>
                    <button class="btn btn-line" type="button" id="btnSend">LINEで送る</button>
                  </div>

                  <div class="muted" style="margin-top:10px;">
                    ※ 端末によってLINEが開かない場合は、いったん友だち追加→戻ってもう一度「LINEで送る」を押してください。
                  </div>
                </div>
              </div>
            </section>
          </div>
        </div>
      </article>

  </main>

  <script>
    (function(){
      var C = window.CONFIG || {};

      // header
      var companyName = document.getElementById('companyName');
      if (companyName && C.COMPANY_NAME) companyName.textContent = C.COMPANY_NAME;

      var mail = (C.EMAIL_TO || '').trim();
      var tel = (C.TEL || '').trim();
      var headerMailLink = document.getElementById('headerMailLink');
      var headerTelLink = document.getElementById('headerTelLink');
      if (headerMailLink && mail) headerMailLink.href = 'mailto:' + mail;
      if (headerTelLink && tel) headerTelLink.href = 'tel:' + tel.replace(/[^0-9+]/g,'');

      // add friend
      var addUrl = (C.LINE_URL || '').trim();
      var btnAddFriend = document.getElementById('btnAddFriend');
      if (btnAddFriend) btnAddFriend.href = addUrl || '#';

      function getSelectedType(){
        var el = document.querySelector('input[name="consultType"]:checked');
        return el ? el.value : '';
      }

      function buildMessage(){
        var type = getSelectedType() || '未選択';
        var note = (document.getElementById('note').value || '').trim();
        if (!note) note = '未入力';

        return [
          '【相談カテゴリ】',
          type,
          '',
          '【備考】',
          note
        ].join('\n');
      }

      function openLineWithText(text){
        var msg = encodeURIComponent(String(text || '').slice(0, 5000));
        var oa = (C.LINE_OA_ID || '').trim();
        if (oa) {
          if (oa[0] !== '@') oa = '@' + oa;
          var oaEnc = encodeURIComponent(oa);
          var isMobile = /iphone|ipad|ipod|android/i.test(navigator.userAgent || '');
          var base = isMobile ? 'line://oaMessage/' : 'https://line.me/R/oaMessage/';
          location.href = base + oaEnc + '/?' + msg;
          return;
        }
        // fallback: share text
        location.href = 'https://line.me/R/msg/text/?' + msg;
      }

      // UI actions
      var btnBuild = document.getElementById('btnBuild');
      var btnSend = document.getElementById('btnSend');
      var btnEdit = document.getElementById('btnEdit');
      var previewBox = document.getElementById('previewBox');
      var previewText = document.getElementById('previewText');

      function showPreview(){
        var msg = buildMessage();
        previewText.textContent = msg;
        previewBox.style.display = 'block';
        previewBox.scrollIntoView({behavior:'smooth', block:'start'});
      }

      if (btnBuild) btnBuild.addEventListener('click', showPreview);
      if (btnEdit) btnEdit.addEventListener('click', function(){
        // プレビューを閉じず、入力欄へ戻す（視覚的に修正が成立する）
        document.getElementById('note').focus();
        document.getElementById('consultCard').scrollIntoView({behavior:'smooth', block:'start'});
      });
      if (btnSend) btnSend.addEventListener('click', function(){
        openLineWithText(buildMessage());
      });
    })();
  </script>
</body>
</html>
