<!doctype html>
<html lang="ja" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="robots" content="noindex, nofollow" />
  <title>本人確認（本登録）｜drivers-site</title>
  <meta name="description" content="本人確認（本登録）フォーム。必須：氏名、住所（郵便番号から自動入力可）、軽車両・経験年数、顔写真、免許証（表/裏）、自動車保険証券写真。任意：貨物保険証券。" />
  <link rel="canonical" href="https://takeshimonoseki.github.io/full-register.html" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { deep: '#050505', muted: '#94A3B8' },
          fontFamily: { sans: ['Inter','sans-serif'], mono: ['JetBrains Mono','monospace'] }
        }
      }
    }
  </script>

  <link rel="stylesheet" href="./drivers.css" />
  <link rel="stylesheet" href="./assets/sakura.css" />
  <script src="./config.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    .field-input {
      width: 100%;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 10px 14px;
      color: white;
      font-size: 14px;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .field-input:focus {
      outline: none;
      border-color: rgba(56,189,248,0.5);
      box-shadow: 0 0 0 3px rgba(56,189,248,0.1);
    }
    textarea.field-input { resize: vertical; min-height: 90px; }
    select.field-input { appearance: none; cursor: pointer; }
    .is-invalid { border-color: rgba(239,68,68,0.6) !important; }
    .is-invalid:focus { box-shadow: 0 0 0 3px rgba(239,68,68,0.15) !important; }

    .error-banner {
      padding: 16px; border-radius: 16px;
      background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3);
      color: #fca5a5; font-size: 14px;
    }
    .success-banner {
      padding: 20px; border-radius: 16px;
      background: rgba(34,197,94,0.1); border: 1px solid rgba(34,197,94,0.3);
      color: #86efac; font-size: 14px;
    }
    #agreeLabel { font-size: 13px; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 10px; }
    #agreeLabel input { accent-color: #38bdf8; }
    .note-link { color: #38bdf8; text-decoration: underline; text-underline-offset: 2px; }
  </style>
</head>

<body class="bg-deep text-white min-h-screen">
  <header class="sticky top-0 w-full z-[1000] bg-deep/80 backdrop-blur-xl border-b border-white/5" id="top">
    <div class="header-inner max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
      <a href="./index.html" class="flex items-center gap-3 group">
        <div class="hidden sm:flex flex-col items-center justify-center px-3 py-1 bg-white/5 border border-white/10 rounded-full" aria-label="対応地域">
          <div class="text-[9px] tracking-widest font-extrabold text-white/80" id="regionEn">YAMAGUCHI</div>
          <div class="text-[9px] font-bold text-white/50" id="regionJa">山口県</div>
        </div>
        <div class="w-9 h-9 rounded-xl bg-gradient-to-br from-red-900 to-red-500 flex items-center justify-center shadow-lg shadow-red-900/30" aria-hidden="true">
          <span class="w-4 h-4 rounded-full border-2 border-white/90"></span>
        </div>
        <div>
          <div class="text-sm font-black tracking-wide leading-none" id="companyName">軽貨物TAKE</div>
          <div class="text-[10px] text-muted font-bold font-mono mt-0.5">DRIVERS POOL</div>
        </div>
      </a>

      <div class="flex items-center gap-4 flex-wrap">
        <div class="hidden lg:flex items-center gap-3 text-xs text-muted" aria-label="連絡先">
          <a href="https://line.me/R/ti/p/%40277rcesk" id="headerLineLink" data-line-ui="1" class="hover:text-white transition-colors" target="_blank" rel="noopener noreferrer">LINE</a>
          <span class="text-white/20">|</span>
          <a href="#" id="headerMailLink" class="hover:text-white transition-colors">takeshimonoseki@gmail.com</a>
        </div>

        <nav class="hidden md:flex gap-1 flex-wrap" aria-label="メイン">
          <a href="./index.html" class="px-4 py-2 rounded-full text-xs font-bold text-muted hover:text-white hover:bg-white/5 transition-colors">トップ</a>
          <a href="./consult.html" class="px-4 py-2 rounded-full text-xs font-bold text-muted hover:text-white hover:bg-white/5 transition-colors">相談スタート</a>
          <a href="./startup.html" class="px-4 py-2 rounded-full text-xs font-bold text-muted hover:text-white hover:bg-white/5 transition-colors">開業トータル相談</a>
          <a href="./vehicle.html" class="px-4 py-2 rounded-full text-xs font-bold text-muted hover:text-white hover:bg-white/5 transition-colors">車両の相談</a>
          <a href="./register.html" class="px-4 py-2 rounded-full text-xs font-bold text-muted hover:text-white hover:bg-white/5 transition-colors">仮登録</a>
        </nav>

        <button type="button" class="md:hidden p-2 text-white bg-white/10 rounded-full hover:bg-white/20 transition-colors" aria-label="メニューを開く" aria-expanded="false" aria-controls="nav-overlay" id="menu-toggle">
          <i data-lucide="menu" class="w-5 h-5"></i>
        </button>
      </div>
    </div>
  </header>

  <div id="nav-overlay" aria-hidden="true" role="dialog" aria-label="メニュー">
    <button type="button" class="nav-overlay-close" aria-label="メニューを閉じる" id="menu-close">
      <i data-lucide="x" class="w-6 h-6"></i>
    </button>
    <a href="./index.html">トップ</a>
    <a href="./consult.html">相談スタート</a>
    <a href="./startup.html">開業トータル相談</a>
    <a href="./vehicle.html">車両の相談</a>
    <a href="./register.html">仮登録</a>
  </div>

  <main class="pt-24 pb-16 px-4 sm:px-6 lg:px-8 max-w-3xl mx-auto">
    <div class="glass-card p-6 md:p-10 mb-6 reveal-hidden relative overflow-hidden">
      <div class="absolute -top-20 -right-20 w-[300px] h-[300px] bg-gradient-to-br from-blue-600/10 to-transparent rounded-full blur-3xl pointer-events-none"></div>
      <div class="relative z-10">
        <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/5 border border-white/10 text-[11px] font-bold text-muted mb-4">
          <i data-lucide="shield" class="w-3 h-3"></i> noindex（案内された方のみ）
        </span>

        <h1 class="text-2xl sm:text-3xl font-black tracking-tight mb-3">本人確認（本登録）フォーム</h1>
        <p class="text-sm text-muted leading-relaxed mb-2">
          必須：氏名／住所（郵便番号から自動入力可）／軽車両・経験年数／顔写真／免許証（表・裏）／自動車保険証券写真。任意：貨物保険証券（あれば）。
        </p>
        <p class="text-xs text-white/40">
          公開プロフィール（必須）は、お客さま向け掲載用です。住所・車両は上で入力した値が初期表示され、編集できます。
        </p>
      </div>
    </div>

    <div class="glass-card p-6 md:p-10 reveal-hidden delay-100">
      <form id="fullRegisterForm" novalidate>

        <div id="errorBox" class="error-banner mb-6" style="display:none;">
          <strong>送信できませんでした。</strong>
          <div class="mt-2" id="errorText">赤枠の項目をご確認ください。</div>
        </div>

        <div id="successBox" class="success-banner mb-6" style="display:none;">
          <strong>送信しました。</strong>
          <div class="mt-2 text-white/70 text-sm">受付ID：<span id="receiptId" class="font-mono"></span></div>
          <div class="mt-2 text-white/60 text-xs">確認後、必要に応じて運営から連絡します。</div>
        </div>

        <div class="p-5 rounded-2xl border border-amber-500/20 bg-amber-500/5 mb-6">
          <div class="flex items-center gap-2 mb-5">
            <i data-lucide="zap" class="w-4 h-4 text-amber-400"></i>
            <span class="font-bold text-sm">必須</span>
          </div>

          <div class="space-y-5">
            <div>
              <label class="text-sm font-bold mb-2 block" for="fullName">氏名</label>
              <input type="text" id="fullName" class="field-input" placeholder="例：山田 太郎" autocomplete="name" />
            </div>

            <!-- 住所：郵便番号→自動入力 -->
            <div>
              <label class="text-sm font-bold mb-2 block" for="postalCode">郵便番号（7桁）</label>
              <div class="flex gap-2">
                <input type="text" id="postalCode" class="field-input" placeholder="例：7500023" maxlength="7" pattern="[0-9]*" inputmode="numeric" />
                <button type="button" id="btnZipLookup" class="flex-shrink-0 px-4 py-2 rounded-xl bg-white/10 border border-white/20 text-sm font-bold hover:bg-white/20 transition-colors">住所を自動入力</button>
              </div>
              <div class="text-xs text-white/40 mt-1">ハイフンなし7桁。失敗時は手入力で続行できます。</div>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
              <div>
                <label class="text-sm font-bold mb-2 block" for="prefecture">都道府県</label>
                <select id="prefecture" class="field-input"></select>
              </div>
              <div>
                <label class="text-sm font-bold mb-2 block" for="city">市区町村</label>
                <input type="text" id="city" class="field-input" placeholder="例：下関市" />
              </div>
              <div>
                <label class="text-sm font-bold mb-2 block" for="addressLine">町名・番地以降</label>
                <input type="text" id="addressLine" class="field-input" placeholder="例：〇〇町1-2-3" autocomplete="street-address" />
              </div>
            </div>

            <!-- 車両（軽のみ）必須 -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="text-sm font-bold mb-2 block" for="maker">車両メーカー（軽）</label>
                <select id="maker" class="field-input">
                  <option value="">選択してください</option>
                  <option value="ダイハツ">ダイハツ</option>
                  <option value="スズキ">スズキ</option>
                  <option value="日産">日産</option>
                  <option value="三菱">三菱</option>
                  <option value="ホンダ">ホンダ</option>
                  <option value="マツダ">マツダ</option>
                  <option value="スバル">スバル</option>
                </select>
              </div>
              <div>
                <label class="text-sm font-bold mb-2 block" for="model">車種（軽）</label>
                <select id="model" class="field-input">
                  <option value="">メーカーを選択</option>
                </select>
              </div>
            </div>

            <!-- 経験年数 -->
            <div>
              <label class="text-sm font-bold mb-2 block" for="experienceYears">経験年数</label>
              <select id="experienceYears" class="field-input">
                <option value="">選択してください</option>
                <option value="1年">1年</option>
                <option value="2年">2年</option>
                <option value="3年">3年</option>
                <option value="4年">4年</option>
                <option value="5年以上">5年以上</option>
              </select>
            </div>

            <!-- 写真：必須4つ・任意1つ -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="text-sm font-bold mb-2 block" for="facePhoto">顔写真（必須）</label>
                <input type="file" id="facePhoto" class="field-input" accept="image/*" />
                <div class="text-xs text-white/40 mt-1">本人確認用（公開しません）。</div>
              </div>
              <div>
                <label class="text-sm font-bold mb-2 block" for="autoInsurance">自動車保険証券写真（必須）</label>
                <input type="file" id="autoInsurance" class="field-input" accept="image/*,application/pdf" />
              </div>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="text-sm font-bold mb-2 block" for="licenseFront">免許証（表）（必須）</label>
                <input type="file" id="licenseFront" class="field-input" accept="image/*" />
              </div>
              <div>
                <label class="text-sm font-bold mb-2 block" for="licenseBack">免許証（裏）（必須）</label>
                <input type="file" id="licenseBack" class="field-input" accept="image/*" />
              </div>
            </div>
            <div>
              <label class="text-sm font-bold mb-2 block" for="cargoInsurance">貨物保険証券（任意）</label>
              <input type="file" id="cargoInsurance" class="field-input" accept="image/*,application/pdf" />
              <div class="text-xs text-white/40 mt-1">
                PickGoの「貨物の保障」公式説明：
                <a class="note-link" href="https://lp.partner.pickgo.town/partner/support/insurance" target="_blank" rel="noopener noreferrer">こちら</a>
              </div>
            </div>
          </div>
        </div>

        <!-- 公開プロフィール（必須） -->
        <div class="p-5 rounded-2xl border border-amber-500/20 bg-amber-500/5 mb-6">
          <div class="flex items-center gap-2 mb-5">
            <i data-lucide="user" class="w-4 h-4 text-amber-400"></i>
            <span class="font-bold text-sm">公開プロフィール（必須）</span>
          </div>
          <p class="text-xs text-white/60 mb-4">お客さま向け掲載用。上の住所・車両が初期値で入ります（編集可）。</p>

          <div class="space-y-5">
            <div>
              <label class="text-sm font-bold mb-2 block" for="nickname">ニックネーム（公開）</label>
              <input type="text" id="nickname" class="field-input" placeholder="例：やまぐち便" autocomplete="off" />
              <div class="text-xs text-white/40 mt-1">本名ではなくこちらを公開します。</div>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="text-sm font-bold mb-2 block" for="publicPrefecture">都道府県（公開）</label>
                <select id="publicPrefecture" class="field-input"></select>
              </div>
              <div>
                <label class="text-sm font-bold mb-2 block" for="publicCity">市区町村（公開）</label>
                <input type="text" id="publicCity" class="field-input" placeholder="例：下関市" />
              </div>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="text-sm font-bold mb-2 block" for="publicMaker">メーカー（公開）</label>
                <select id="publicMaker" class="field-input">
                  <option value="">選択</option>
                  <option value="ダイハツ">ダイハツ</option>
                  <option value="スズキ">スズキ</option>
                  <option value="日産">日産</option>
                  <option value="三菱">三菱</option>
                  <option value="ホンダ">ホンダ</option>
                  <option value="マツダ">マツダ</option>
                  <option value="スバル">スバル</option>
                </select>
              </div>
              <div>
                <label class="text-sm font-bold mb-2 block" for="publicModel">車種（公開）</label>
                <select id="publicModel" class="field-input">
                  <option value="">メーカーを選択</option>
                </select>
              </div>
            </div>
            <div>
              <label class="text-sm font-bold mb-2 block" for="publicAppeal">アピールポイント（公開）</label>
              <textarea id="publicAppeal" class="field-input" placeholder="例：丁寧にやります。時間厳守。"></textarea>
            </div>
          </div>
        </div>

        <div class="p-5 rounded-2xl border border-white/10 bg-white/5 mb-6">
          <label id="agreeLabel">
            <input type="checkbox" id="agree" />
            <span>内容に同意します（20%手数料／指名は希望のみ（確約なし）／電話導線なし）</span>
          </label>
          <div class="text-xs text-white/40 mt-2">※本人確認情報は公開しません。</div>
        </div>

        <button id="submitBtn" type="submit" class="w-full flex items-center justify-center gap-2 px-4 py-4 rounded-2xl bg-white text-black font-black text-sm shadow-lg shadow-white/10 hover:shadow-white/20 transition-all">
          <i data-lucide="send" class="w-4 h-4"></i> 送信する
        </button>
        <div class="text-xs text-white/45 mt-3" id="hintText"></div>
      </form>
    </div>
  </main>

  <script>
    lucide.createIcons();

    (function applyConfig() {
      if (!window.CONFIG) return;
      var regionJa = document.getElementById("regionJa");
      var regionEn = document.getElementById("regionEn");
      var companyName = document.getElementById("companyName");
      if (regionJa) regionJa.textContent = window.CONFIG.REGION_LABEL || "山口県";
      if (regionEn) regionEn.textContent = (window.CONFIG.REGION_CODE || "YAMAGUCHI").toUpperCase();
      if (companyName) companyName.textContent = window.CONFIG.COMPANY_NAME || "軽貨物TAKE";

      var email = window.CONFIG.EMAIL_TO || "";
      var mailLink = document.getElementById("headerMailLink");
      if (mailLink && email) { mailLink.href = "mailto:" + email; mailLink.textContent = email; }

      var lineUrl = window.CONFIG.LINE_URL || "https://line.me/R/ti/p/%40277rcesk";
      var headerLineLink = document.getElementById("headerLineLink");
      if (headerLineLink) headerLineLink.href = lineUrl;
    })();

    const MAX_MB = (window.CONFIG && window.CONFIG.MAX_FILE_MB) ? Number(window.CONFIG.MAX_FILE_MB) : 5;
    const ENDPOINT = (window.CONFIG && window.CONFIG.GAS_ENDPOINT) ? String(window.CONFIG.GAS_ENDPOINT) : "";

    const PREFECTURES = ["北海道","青森県","岩手県","宮城県","秋田県","山形県","福島県","茨城県","栃木県","群馬県","埼玉県","千葉県","東京都","神奈川県","新潟県","富山県","石川県","福井県","山梨県","長野県","岐阜県","静岡県","愛知県","三重県","滋賀県","京都府","大阪府","兵庫県","奈良県","和歌山県","鳥取県","島根県","岡山県","広島県","山口県","徳島県","香川県","愛媛県","高知県","福岡県","佐賀県","長崎県","熊本県","大分県","宮崎県","鹿児島県","沖縄県"];

    const VEHICLE_MODELS = {
      "ダイハツ": ["ハイゼットカーゴ", "ハイゼットトラック", "アトレー"],
      "スズキ": ["エブリイ", "キャリイ"],
      "日産": ["NV100クリッパー"],
      "三菱": ["ミニキャブ"],
      "ホンダ": ["N-VAN"],
      "マツダ": ["スクラム"],
      "スバル": ["サンバー"]
    };

    const el = (id) => document.getElementById(id);
    const form = el("fullRegisterForm");
    const errorBox = el("errorBox");
    const errorText = el("errorText");
    const successBox = el("successBox");
    const receiptIdEl = el("receiptId");
    const hintText = el("hintText");
    const submitBtn = el("submitBtn");

    const fullName = el("fullName");
    const postalCode = el("postalCode");
    const prefecture = el("prefecture");
    const city = el("city");
    const addressLine = el("addressLine");
    const maker = el("maker");
    const model = el("model");
    const experienceYears = el("experienceYears");
    const facePhoto = el("facePhoto");
    const licenseFront = el("licenseFront");
    const licenseBack = el("licenseBack");
    const autoInsurance = el("autoInsurance");
    const cargoInsurance = el("cargoInsurance");
    const nickname = el("nickname");
    const publicPrefecture = el("publicPrefecture");
    const publicCity = el("publicCity");
    const publicMaker = el("publicMaker");
    const publicModel = el("publicModel");
    const publicAppeal = el("publicAppeal");
    const agree = el("agree");

    function fillPrefectureSelect(selectEl) {
      if (!selectEl) return;
      selectEl.innerHTML = "<option value=\"\">選択してください</option>" + PREFECTURES.map(p => "<option value=\"" + p + "\">" + p + "</option>").join("");
    }
    fillPrefectureSelect(prefecture);
    fillPrefectureSelect(publicPrefecture);

    function updateModelSelect(makerSelect, modelSelect) {
      const m = (makerSelect && makerSelect.value) || "";
      modelSelect.innerHTML = "<option value=\"\">" + (m ? "選択" : "メーカーを選択") + "</option>";
      if (m && VEHICLE_MODELS[m]) {
        VEHICLE_MODELS[m].forEach(mod => {
          modelSelect.innerHTML += "<option value=\"" + mod + "\">" + mod + "</option>";
        });
      }
    }
    maker.addEventListener("change", () => { updateModelSelect(maker, model); syncPublicVehicle(); });
    publicMaker.addEventListener("change", () => updateModelSelect(publicMaker, publicModel));

    function syncPublicVehicle() {
      if (publicPrefecture && prefecture) publicPrefecture.value = prefecture.value;
      if (publicCity && city) publicCity.value = city.value;
      if (publicMaker && maker) publicMaker.value = maker.value;
      updateModelSelect(publicMaker, publicModel);
      if (publicModel && model) publicModel.value = model.value;
    }
    prefecture.addEventListener("change", () => { if (publicPrefecture) publicPrefecture.value = prefecture.value; });
    city.addEventListener("input", () => { if (publicCity) publicCity.value = city.value; });
    maker.addEventListener("change", syncPublicVehicle);
    model.addEventListener("change", () => { if (publicModel) publicModel.value = model.value; });

    el("btnZipLookup").addEventListener("click", doZipLookup);
    postalCode.addEventListener("blur", function() { if ((postalCode.value || "").replace(/\D/g, "").length === 7) doZipLookup(); });

    function doZipLookup() {
      const zip = (postalCode.value || "").replace(/\D/g, "");
      if (zip.length !== 7) return;
      fetch("https://zipcloud.ibsnet.co.jp/api/search?zipcode=" + zip)
        .then(r => r.json())
        .then(data => {
          if (data.status !== 200 || !data.results || !data.results[0]) return;
          const r = data.results[0];
          prefecture.value = (r.address1 || "") || prefecture.value;
          city.value = (r.address2 || "") || city.value;
          addressLine.value = (r.address3 || "") || addressLine.value;
          syncPublicVehicle();
        })
        .catch(() => {});
    }

    postalCode.addEventListener("input", function() {
      this.value = this.value.replace(/\D/g, "").slice(0, 7);
    });

    function makeReceiptId() {
      const ts = Date.now().toString(36);
      const r = Math.floor(Math.random()*1e6).toString(36).padStart(4,"0");
      return "DRF-" + ts + "-" + r;
    }

    const allInputs = [fullName, postalCode, prefecture, city, addressLine, maker, model, experienceYears, facePhoto, licenseFront, licenseBack, autoInsurance, cargoInsurance, nickname, publicPrefecture, publicCity, publicMaker, publicModel, publicAppeal, agree];
    function clearInvalid() {
      allInputs.forEach(x => {
        if (!x) return;
        x.classList.remove("is-invalid");
      });
    }

    function setError(msg) {
      errorText.textContent = msg;
      errorBox.style.display = "";
      successBox.style.display = "none";
      errorBox.scrollIntoView({behavior:"smooth", block:"center"});
    }

    function fileToDataUrl(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(String(reader.result || ""));
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    function getFile(input) {
      return (input && input.files && input.files[0]) ? input.files[0] : null;
    }

    function checkSize(file, inputEl) {
      if (!file) return true;
      if (file.size <= MAX_MB * 1024 * 1024) return true;
      if (inputEl) inputEl.classList.add("is-invalid");
      setError("ファイルが大きすぎます（上限 " + MAX_MB + "MB）。：" + (file.name || "file"));
      return false;
    }

    function validate() {
      clearInvalid();
      errorBox.style.display = "none";

      const n = (fullName.value || "").trim();
      const pc = (postalCode.value || "").replace(/\D/g, "");
      const pref = (prefecture.value || "").trim();
      const c = (city.value || "").trim();
      const al = (addressLine.value || "").trim();
      const m = (maker.value || "").trim();
      const mod = (model.value || "").trim();
      const exp = (experienceYears.value || "").trim();
      const nick = (nickname.value || "").trim();
      const pubPref = (publicPrefecture.value || "").trim();
      const pubCity = (publicCity.value || "").trim();
      const pubMaker = (publicMaker.value || "").trim();
      const pubModel = (publicModel.value || "").trim();
      const pubAppeal = (publicAppeal.value || "").trim();

      const fFace = getFile(facePhoto);
      const fLf = getFile(licenseFront);
      const fLb = getFile(licenseBack);
      const fAi = getFile(autoInsurance);
      const fCi = getFile(cargoInsurance);

      if (!n) { fullName.classList.add("is-invalid"); return {ok:false, msg:"氏名を入力してください。"}; }
      if (pc.length !== 7) { postalCode.classList.add("is-invalid"); return {ok:false, msg:"郵便番号を7桁で入力してください。"}; }
      if (!pref) { prefecture.classList.add("is-invalid"); return {ok:false, msg:"都道府県を選択してください。"}; }
      if (!c) { city.classList.add("is-invalid"); return {ok:false, msg:"市区町村を入力してください。"}; }
      if (!al) { addressLine.classList.add("is-invalid"); return {ok:false, msg:"町名・番地以降を入力してください。"}; }
      if (!m) { maker.classList.add("is-invalid"); return {ok:false, msg:"車両メーカーを選択してください。"}; }
      if (!mod) { model.classList.add("is-invalid"); return {ok:false, msg:"車種を選択してください。"}; }
      if (!exp) { experienceYears.classList.add("is-invalid"); return {ok:false, msg:"経験年数を選択してください。"}; }

      if (!fFace) { facePhoto.classList.add("is-invalid"); return {ok:false, msg:"顔写真を添付してください。"}; }
      if (!fLf) { licenseFront.classList.add("is-invalid"); return {ok:false, msg:"免許証（表）を添付してください。"}; }
      if (!fLb) { licenseBack.classList.add("is-invalid"); return {ok:false, msg:"免許証（裏）を添付してください。"}; }
      if (!fAi) { autoInsurance.classList.add("is-invalid"); return {ok:false, msg:"自動車保険証券写真を添付してください。"}; }

      if (!checkSize(fFace, facePhoto)) return {ok:false};
      if (!checkSize(fLf, licenseFront)) return {ok:false};
      if (!checkSize(fLb, licenseBack)) return {ok:false};
      if (!checkSize(fAi, autoInsurance)) return {ok:false};
      if (fCi && !checkSize(fCi, cargoInsurance)) return {ok:false};

      if (!nick) { nickname.classList.add("is-invalid"); return {ok:false, msg:"ニックネーム（公開）を入力してください。"}; }
      if (!pubPref) { publicPrefecture.classList.add("is-invalid"); return {ok:false, msg:"公開用の都道府県を選択してください。"}; }
      if (!pubCity) { publicCity.classList.add("is-invalid"); return {ok:false, msg:"公開用の市区町村を入力してください。"}; }
      if (!pubMaker) { publicMaker.classList.add("is-invalid"); return {ok:false, msg:"公開用のメーカーを選択してください。"}; }
      if (!pubModel) { publicModel.classList.add("is-invalid"); return {ok:false, msg:"公開用の車種を選択してください。"}; }
      if (!pubAppeal) { publicAppeal.classList.add("is-invalid"); return {ok:false, msg:"アピールポイント（公開）を入力してください。"}; }

      if (!agree.checked) { agree.classList.add("is-invalid"); return {ok:false, msg:"同意にチェックしてください。"}; }

      if (!ENDPOINT || ENDPOINT === "あとで貼る") {
        return { ok:false, msg:"送信先（GAS_ENDPOINT）が未設定です（config.js を確認してください）。"};
      }

      const addressFull = pref + c + al;
      return {
        ok: true,
        data: {
          n, addressFull, postalCode: pc, prefecture: pref, city: c, addressLine: al,
          maker: m, model: mod, experienceYears: exp,
          nickname: nick, publicPrefecture: pubPref, publicCity: pubCity, publicMaker: pubMaker, publicModel: pubModel, publicAppeal: pubAppeal,
          fFace, fLf, fLb, fAi, fCi
        }
      };
    }

    function updateHint() {
      hintText.textContent = "上限：" + MAX_MB + "MB（各ファイル）。";
    }
    updateHint();

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const v = validate();
      if (!v.ok) { if (v.msg) setError(v.msg); return; }

      submitBtn.disabled = true;
      submitBtn.innerHTML = "<span class=\"inline-block w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin mr-2\"></span>送信中…";
      errorBox.style.display = "none";
      successBox.style.display = "none";

      try {
        const rid = makeReceiptId();
        const d = v.data;

        const faceUrl = await fileToDataUrl(d.fFace);
        const lfUrl = await fileToDataUrl(d.fLf);
        const lbUrl = await fileToDataUrl(d.fLb);
        const aiUrl = await fileToDataUrl(d.fAi);
        const ciUrl = d.fCi ? await fileToDataUrl(d.fCi) : "";

        const bodyObj = {
          type: "driver_full_register",
          receiptId: rid,
          data: {
            fullName: d.n,
            address: d.addressFull,
            postalCode: d.postalCode,
            prefecture: d.prefecture,
            city: d.city,
            addressLine: d.addressLine,
            maker: d.maker,
            model: d.model,
            experienceYears: d.experienceYears,
            publicProfile: {
              nickname: d.nickname,
              prefecture: d.publicPrefecture,
              city: d.publicCity,
              vehicle: d.publicMaker + " " + d.publicModel,
              maker: d.publicMaker,
              model: d.publicModel,
              experienceYears: d.experienceYears,
              experience: d.experienceYears,
              appeal: d.publicAppeal,
              message: d.publicAppeal,
              tools: ""
            },
            consent: true
          },
          files: {
            facePhoto: { name: d.fFace.name || "facePhoto", type: d.fFace.type || "", dataUrl: faceUrl },
            licenseFront: { name: d.fLf.name || "licenseFront", type: d.fLf.type || "", dataUrl: lfUrl },
            licenseBack: { name: d.fLb.name || "licenseBack", type: d.fLb.type || "", dataUrl: lbUrl },
            autoInsurance: { name: d.fAi.name || "autoInsurance", type: d.fAi.type || "", dataUrl: aiUrl }
          }
        };

        if (d.fCi) {
          bodyObj.files.cargoInsurance = { name: d.fCi.name || "cargoInsurance", type: d.fCi.type || "", dataUrl: ciUrl };
        }

        await fetch(ENDPOINT, {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "text/plain" },
          body: JSON.stringify(bodyObj)
        });

        window.location.href = "thankyou.html?receiptId=" + encodeURIComponent(rid);
        return;
      } catch (err) {
        setError("通信エラーで送信できませんでした。時間をおいて再度お試しください。");
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i data-lucide="send" class="w-4 h-4"></i> 送信する';
        lucide.createIcons();
      }
    });

    document.addEventListener('mousemove', (e) => {
      document.querySelectorAll('.glass-card').forEach(card => {
        const rect = card.getBoundingClientRect();
        card.style.setProperty('--mouse-x', `${e.clientX - rect.left}px`);
        card.style.setProperty('--mouse-y', `${e.clientY - rect.top}px`);
      });
    });

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('reveal-visible');
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.05, rootMargin: "0px 0px -40px 0px" });
    document.querySelectorAll('.reveal-hidden').forEach(elm => observer.observe(elm));

    (function initNavOverlay() {
      var overlay = document.getElementById("nav-overlay");
      var toggle = document.getElementById("menu-toggle");
      var closeBtn = document.getElementById("menu-close");
      if (!overlay || !toggle) return;
      function openMenu() { overlay.setAttribute("aria-hidden", "false"); toggle.setAttribute("aria-expanded", "true"); }
      function closeMenu() { overlay.setAttribute("aria-hidden", "true"); toggle.setAttribute("aria-expanded", "false"); }
      toggle.addEventListener("click", function() { overlay.getAttribute("aria-hidden") === "true" ? openMenu() : closeMenu(); });
      if (closeBtn) closeBtn.addEventListener("click", closeMenu);
      overlay.querySelectorAll("a").forEach(function(a) { a.addEventListener("click", closeMenu); });
      document.addEventListener("keydown", function(e) { if (e.key === "Escape") closeMenu(); });
    })();
  </script>
  <script defer src="./assets/sakura.js"></script>
</body>
</html>
